<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家长控制面板 - 萌芽AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="mengya-common.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .panel-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.1);
            overflow: hidden;
            margin: 16px;
        }
        .panel-header {
            background: linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%);
            color: white;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }
        .panel-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: headerFlow 6s ease-in-out infinite;
        }
        @keyframes headerFlow {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }
        .child-profile {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        .child-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #F59E0B, #D97706);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: avatarGlow 3s ease-in-out infinite;
        }
        @keyframes avatarGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 0 30px rgba(245, 158, 11, 0.6); }
        }
        .child-info h3 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .child-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            opacity: 0.9;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10B981;
            animation: statusPulse 2s ease-in-out infinite;
        }
        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        .quick-stat {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .quick-stat:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.2);
        }
        .quick-stat-value {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .quick-stat-label {
            font-size: 11px;
            opacity: 0.9;
        }
        .dashboard-tabs {
            display: flex;
            background: #f8fafc;
            padding: 0 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        .dashboard-tab {
            padding: 16px 20px;
            cursor: pointer;
            position: relative;
            color: #6b7280;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        .dashboard-tab.active {
            color: #3B82F6;
            border-bottom-color: #3B82F6;
        }
        .dashboard-tab:hover {
            color: #3B82F6;
            background: rgba(59, 130, 246, 0.05);
        }
        .tab-content {
            display: none;
            padding: 24px;
            animation: fadeInUp 0.5s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        .overview-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3B82F6, #1E40AF);
        }
        .overview-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 16px;
        }
        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }
        .card-subtitle {
            font-size: 12px;
            color: #6b7280;
        }
        .progress-section {
            margin: 16px 0;
        }
        .progress-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .progress-label {
            font-size: 13px;
            color: #374151;
            font-weight: 500;
        }
        .progress-value {
            font-size: 13px;
            color: #3B82F6;
            font-weight: 600;
        }
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3B82F6, #1E40AF);
            border-radius: 4px;
            transition: width 1s ease;
        }
        .activity-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .activity-item:hover {
            background: #f8fafc;
        }
        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .activity-content {
            flex: 1;
        }
        .activity-title {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 2px;
        }
        .activity-time {
            font-size: 11px;
            color: #6b7280;
        }
        .activity-score {
            font-size: 12px;
            font-weight: 600;
            color: #10B981;
        }
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        .control-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .control-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .control-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, #3B82F6, #1E40AF);
            color: white;
        }
        .control-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }
        .control-desc {
            font-size: 11px;
            color: #6b7280;
            line-height: 1.4;
        }
        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }
        .settings-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .setting-item:last-child {
            border-bottom: none;
        }
        .setting-item.clickable {
            cursor: pointer;
            border-radius: 8px;
            padding: 12px;
            margin: 0 -12px;
            transition: all 0.3s ease;
        }
        .setting-item.clickable:hover {
            background-color: #f8fafc;
            transform: translateX(4px);
        }
        .setting-info {
            flex: 1;
        }
        .setting-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 2px;
        }
        .setting-desc {
            font-size: 12px;
            color: #6b7280;
        }
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .toggle-switch.active {
            background: #3B82F6;
        }
        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .toggle-switch.active::before {
            transform: translateX(24px);
        }
        .time-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .time-input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
        }
        .report-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .chart-bars {
            display: flex;
            align-items: end;
            justify-content: space-between;
            height: 200px;
            margin-bottom: 16px;
            padding: 0 20px;
            position: relative;
        }
        .chart-bars::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: #E5E7EB;
        }
        .chart-bar {
            width: 24px;
            background: linear-gradient(to top, #3B82F6, #60A5FA);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            min-height: 20px;
        }
        .chart-bar::before {
            content: attr(data-value);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 600;
            color: #374151;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .chart-bar:hover {
            background: linear-gradient(to top, #1E40AF, #3B82F6);
            transform: scaleY(1.05);
        }
        .chart-bar:hover::before {
            opacity: 1;
        }
        .chart-labels {
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 12px;
            color: #6B7280;
        }
        .chart-label {
            text-align: center;
            width: 24px;
        }
        .chart-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
        }
        .chart-title-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #3B82F6, #1E40AF);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        .floating-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }
        .fab-button {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: fabFloat 4s ease-in-out infinite;
        }
        @keyframes fabFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
        }
        .fab-button:hover {
            transform: scale(1.1);
        }
        .fab-primary {
            background: linear-gradient(135deg, #3B82F6, #1E40AF);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
        }
        .fab-secondary {
            background: linear-gradient(135deg, #10B981, #059669);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        .fab-warning {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            min-width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 50%;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            color: white;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            animation: badgePulse 2s infinite;
        }
        .loading-animation {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
        }
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        .alert-card {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border: 1px solid #F59E0B;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .alert-icon {
            width: 40px;
            height: 40px;
            background: #F59E0B;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        .alert-content {
            flex: 1;
        }
        .alert-title {
            font-size: 14px;
            font-weight: 600;
            color: #92400E;
            margin-bottom: 4px;
        }
        .alert-desc {
            font-size: 12px;
            color: #A16207;
            line-height: 1.4;
        }
        .achievement-showcase {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 16px 0;
        }
        .achievement-badge {
            min-width: 80px;
            text-align: center;
            background: white;
            border-radius: 12px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .achievement-badge.earned {
            border-color: #10B981;
            background: linear-gradient(135f, #f0fdf4, #dcfce7);
        }
        .achievement-badge:hover {
            transform: translateY(-2px);
        }
        .achievement-emoji {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .achievement-name {
            font-size: 11px;
            font-weight: 500;
            color: #374151;
        }
        /* 浮动操作按钮样式 */
        .floating-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .fab-button {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: fabFloat 4s ease-in-out infinite;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .fab-button.emergency {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            animation-delay: 0s;
        }

        .fab-button.report {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            animation-delay: 0.5s;
            position: relative;
            overflow: hidden;
        }

        .fab-button.report::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .fab-button.report:hover::before {
            left: 100%;
        }

        .fab-button.report:hover {
            background: linear-gradient(135deg, #2563EB, #1E40AF);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.5);
        }

        .fab-button.report:active {
            transform: scale(0.95);
        }

        /* 报告按钮徽章 */
        .report-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #10B981, #059669);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            z-index: 10;
            animation: reportBadgePulse 2s infinite;
            transition: all 0.3s ease;
        }

        .report-badge.hidden {
            opacity: 0;
            transform: scale(0);
        }

        @keyframes reportBadgePulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }

        .fab-button.monitor {
            background: linear-gradient(135deg, #10B981, #059669);
            animation-delay: 1s;
        }

        .fab-button.settings {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            animation-delay: 1.5s;
        }

        .fab-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }

        .monitor-status {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #EF4444;
            border: 2px solid white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .monitor-status.active {
            opacity: 1;
            animation: pulse 2s infinite;
        }

        /* 紧急控制面板 */
        .emergency-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .emergency-panel.show {
            opacity: 1;
            visibility: visible;
        }

        .emergency-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .emergency-panel.show .emergency-content {
            transform: scale(1);
        }

        .emergency-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #EF4444;
        }

        .emergency-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #EF4444, #DC2626);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .emergency-title {
            flex: 1;
            font-size: 20px;
            font-weight: bold;
            color: #374151;
        }

        .emergency-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #F3F4F6;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .emergency-close:hover {
            background: #E5E7EB;
            color: #374151;
        }

        .emergency-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .emergency-action {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .emergency-action.critical {
            background: linear-gradient(135deg, #FEF2F2, #FEE2E2);
            border-color: #FECACA;
        }

        .emergency-action.critical:hover {
            background: linear-gradient(135deg, #FEE2E2, #FECACA);
            transform: translateY(-2px);
        }

        .emergency-action.warning {
            background: linear-gradient(135deg, #FFFBEB, #FEF3C7);
            border-color: #FDE68A;
        }

        .emergency-action.warning:hover {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            transform: translateY(-2px);
        }

        .emergency-action.info {
            background: linear-gradient(135deg, #EFF6FF, #DBEAFE);
            border-color: #BFDBFE;
        }

        .emergency-action.info:hover {
            background: linear-gradient(135deg, #DBEAFE, #BFDBFE);
            transform: translateY(-2px);
        }

        .emergency-action.urgent {
            background: linear-gradient(135deg, #FDF4FF, #F3E8FF);
            border-color: #E9D5FF;
        }

        .emergency-action.urgent:hover {
            background: linear-gradient(135deg, #F3E8FF, #E9D5FF);
            transform: translateY(-2px);
        }

        .emergency-action.success {
            background: linear-gradient(135deg, #F0FDF4, #DCFCE7);
            border-color: #BBF7D0;
        }

        .emergency-action.success:hover {
            background: linear-gradient(135deg, #DCFCE7, #BBF7D0);
            transform: translateY(-2px);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .emergency-action.critical .action-icon {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }

        .emergency-action.warning .action-icon {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white;
        }

        .emergency-action.info .action-icon {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
        }

        .emergency-action.urgent .action-icon {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            color: white;
        }

        .emergency-action.success .action-icon {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }

        .action-content {
            flex: 1;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 12px;
            color: #6B7280;
        }

        .action-status {
            font-size: 12px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 12px;
            background: #F3F4F6;
            color: #6B7280;
        }

        .action-arrow {
            font-size: 14px;
            color: #9CA3AF;
        }

        /* 紧急联系人 */
        .emergency-contacts {
            border-top: 1px solid #E5E7EB;
            padding-top: 20px;
        }

        .contacts-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
        }

        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #F8FAFC;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .contact-item:hover {
            background: #F1F5F9;
            transform: translateY(-1px);
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 2px;
        }

        .contact-phone {
            font-size: 12px;
            color: #6B7280;
        }

        .contact-action {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        /* 快速设置面板 */
        .quick-settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .quick-settings-panel.show {
            opacity: 1;
            visibility: visible;
        }

        .quick-settings-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .quick-settings-panel.show .quick-settings-content {
            transform: scale(1);
        }

        .quick-settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #E5E7EB;
        }

        .settings-title {
            font-size: 20px;
            font-weight: bold;
            color: #374151;
        }

        .settings-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #F3F4F6;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-settings-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }

        .quick-setting-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #F8FAFC;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
        }

        .setting-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .setting-content {
            flex: 1;
        }

        .setting-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .time-btn {
            padding: 6px 12px;
            background: #E5E7EB;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-btn:hover {
            background: #D1D5DB;
        }

        .time-display {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            min-width: 60px;
            text-align: center;
        }

        .difficulty-select {
            padding: 8px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .filter-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 4px 12px;
            background: #E5E7EB;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tag.active {
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
        }

        .reminder-times {
            display: flex;
            gap: 8px;
        }

        .time-input {
            padding: 6px 8px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 12px;
        }

        .reward-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .reward-option {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #D1D5DB;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .quick-settings-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 16px;
            border-top: 1px solid #E5E7EB;
        }

        .settings-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .settings-btn.secondary {
            background: #F3F4F6;
            color: #6B7280;
        }

        .settings-btn.secondary:hover {
            background: #E5E7EB;
        }

        .settings-btn.primary {
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
        }

        .settings-btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        /* 实时监控面板 */
        .monitor-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .monitor-panel.show {
            opacity: 1;
            visibility: visible;
        }

        .monitor-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .monitor-panel.show .monitor-content {
            transform: scale(1);
        }

        .monitor-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #E5E7EB;
        }

        .monitor-title {
            font-size: 20px;
            font-weight: bold;
            color: #374151;
        }

        .monitor-status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #10B981;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10B981;
        }

        .status-dot.active {
            animation: pulse 2s infinite;
        }

        .monitor-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #F3F4F6;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .monitor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .monitor-stat {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #F8FAFC;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 11px;
            color: #6B7280;
        }

        .activity-timeline {
            margin-bottom: 20px;
        }

        .timeline-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
        }

        .timeline-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .timeline-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #F8FAFC;
            border-radius: 8px;
            border-left: 3px solid #10B981;
        }

        .timeline-time {
            font-size: 11px;
            font-weight: 600;
            color: #6B7280;
            min-width: 40px;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-action {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 2px;
        }

        .timeline-score {
            font-size: 11px;
            color: #10B981;
        }

        .monitor-alerts {
            border-top: 1px solid #E5E7EB;
            padding-top: 16px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 8px;
            font-size: 12px;
            color: #92400E;
        }

        .alert-item.warning {
            background: #FEF3C7;
            border-color: #F59E0B;
            color: #92400E;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        @keyframes fabFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-6px);
            }
        }

        /* 确保面板默认隐藏 */
        .emergency-panel,
        .quick-settings-panel,
        .monitor-panel {
            opacity: 0;
            visibility: hidden;
            transform: scale(0.95);
            transition: all 0.3s ease;
        }

        /* 显示状态 */
        .emergency-panel.show,
        .quick-settings-panel.show,
        .monitor-panel.show {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }

        /* 关闭按钮样式 */
        .emergency-close,
        .settings-close,
        .monitor-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .emergency-close:hover,
        .settings-close:hover,
        .monitor-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* 监控面板样式 */
        .monitor-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1003;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .monitor-panel.show {
            opacity: 1;
            visibility: visible;
        }

        .monitor-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .monitor-panel.show .monitor-content {
            transform: scale(1);
        }

        .monitor-header {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 20px 20px 0 0;
        }

        .monitor-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 600;
        }

        .monitor-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .monitor-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .monitor-body {
            padding: 20px;
        }

        .monitor-section {
            margin-bottom: 24px;
        }

        .monitor-section:last-child {
            margin-bottom: 0;
        }

        .monitor-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .monitor-stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .monitor-stat {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #F8FAFC;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
        }

        .monitor-stat-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .monitor-stat-info {
            flex: 1;
        }

        .monitor-stat-label {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 2px;
        }

        .monitor-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
        }

        .activity-timeline {
            max-height: 200px;
            overflow-y: auto;
        }

        .timeline-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #F8FAFC;
            border-radius: 8px;
            border-left: 3px solid #10B981;
            margin-bottom: 8px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-time {
            font-size: 11px;
            font-weight: 600;
            color: #6B7280;
            min-width: 40px;
            flex-shrink: 0;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-action {
            font-size: 13px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 2px;
        }

        .timeline-score {
            font-size: 11px;
            color: #10B981;
        }

        .monitor-alerts {
            min-height: 40px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 8px;
            font-size: 12px;
            color: #92400E;
            animation: alertSlideIn 0.3s ease;
        }

        @keyframes alertSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-item.warning {
            background: #FEF3C7;
            border-color: #F59E0B;
            color: #92400E;
        }

        .alert-item i {
            color: #F59E0B;
        }

        /* 超现代化通知中心样式 */
        .notification-center-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 20px;
            padding-top: 80px;
        }

        .notification-center-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .notification-center-content {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 28px;
            width: 100%;
            max-width: 480px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 
                0 32px 64px -12px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-40px) scale(0.85) rotateX(15deg);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .notification-center-modal.show .notification-center-content {
            transform: translateY(0) scale(1) rotateX(0deg);
        }

        /* 通知中心头部 */
        .notification-center-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8B5CF6 100%);
            color: white;
            padding: 28px 28px 24px 28px;
            position: relative;
            overflow: hidden;
        }

        .notification-center-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            animation: headerShine 4s infinite;
        }

        .notification-center-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        @keyframes headerShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .notification-header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .notification-center-title {
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .notification-title-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            animation: iconPulse 3s ease-in-out infinite;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes iconPulse {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
            }
            25% { 
                transform: scale(1.05) rotate(-2deg); 
                box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
            }
            50% { 
                transform: scale(1.1) rotate(0deg); 
                box-shadow: 0 0 0 8px rgba(255, 255, 255, 0.1);
            }
            75% { 
                transform: scale(1.05) rotate(2deg); 
                box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
            }
        }

        .notification-close-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 14px;
        }

        .notification-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1) rotate(90deg);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .notification-close-btn:active {
            transform: scale(0.95);
        }

        .notification-stats {
            display: flex;
            gap: 24px;
            font-size: 14px;
            opacity: 0.95;
            font-weight: 500;
        }

        .notification-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .notification-stat:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .stat-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .stat-dot.unread {
            background: #FF6B6B;
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.2);
                box-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
            }
        }

        /* 通知筛选标签 */
        .notification-filters {
            display: flex;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 8px 12px;
            gap: 4px;
        }

        .notification-filters::-webkit-scrollbar {
            display: none;
        }

        .notification-filter {
            flex-shrink: 0;
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            white-space: nowrap;
            border-radius: 16px;
            border: 1px solid transparent;
        }

        .notification-filter.active {
            color: #667eea;
            background: white;
            border-color: rgba(103, 126, 234, 0.2);
            box-shadow: 
                0 4px 12px rgba(103, 126, 234, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
        }

        .notification-filter.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 1px;
        }

        .notification-filter:hover:not(.active) {
            color: #374151;
            background: rgba(103, 126, 234, 0.08);
            transform: translateY(-1px);
            border-color: rgba(103, 126, 234, 0.1);
        }

        /* 通知列表 */
        .notification-list-container {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .notification-list-container::-webkit-scrollbar {
            width: 4px;
        }

        .notification-list-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .notification-list-container::-webkit-scrollbar-thumb {
            background: rgba(103, 126, 234, 0.3);
            border-radius: 2px;
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            margin: 0 8px;
            border-radius: 12px;
            margin-bottom: 4px;
        }

        .notification-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(103, 126, 234, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .notification-item:hover::before {
            left: 100%;
        }

        .notification-item:hover {
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.02) 0%, rgba(139, 92, 246, 0.02) 100%);
            transform: translateX(4px);
            border-color: rgba(103, 126, 234, 0.1);
            box-shadow: 
                0 4px 20px rgba(103, 126, 234, 0.08),
                0 0 0 1px rgba(103, 126, 234, 0.05);
        }

        .notification-item.unread {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.03) 0%, rgba(139, 92, 246, 0.03) 100%);
            border-left: 3px solid #3B82F6;
            padding-left: 21px;
        }

        .notification-item.unread::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 24px;
            width: 8px;
            height: 8px;
            background: #3B82F6;
            border-radius: 50%;
            animation: unreadPulse 2s infinite;
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
        }

        @keyframes unreadPulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 6px rgba(59, 130, 246, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-icon {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            position: relative;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.12),
                0 0 0 1px rgba(255, 255, 255, 0.8);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: iconGlow 3s ease-in-out infinite;
        }

        .notification-icon::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 18px;
            background: inherit;
            z-index: -1;
            opacity: 0.3;
            filter: blur(8px);
        }

        .notification-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }

        @keyframes iconGlow {
            0%, 100% { 
                box-shadow: 
                    0 4px 16px rgba(0, 0, 0, 0.12),
                    0 0 0 1px rgba(255, 255, 255, 0.8);
            }
            50% { 
                box-shadow: 
                    0 6px 20px rgba(0, 0, 0, 0.15),
                    0 0 0 1px rgba(255, 255, 255, 0.9),
                    0 0 20px rgba(255, 255, 255, 0.2);
            }
        }

        .notification-icon.child-activity {
            background: linear-gradient(135deg, #22c55e, #16a34a, #15803d);
            color: white;
        }

        .notification-icon.system {
            background: linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8);
            color: white;
        }

        .notification-icon.achievement {
            background: linear-gradient(135deg, #f59e0b, #d97706, #b45309);
            color: white;
        }

        .notification-icon.alert {
            background: linear-gradient(135deg, #ef4444, #dc2626, #b91c1c);
            color: white;
        }

        .notification-icon.report {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed, #6d28d9);
            color: white;
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-size: 15px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 6px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            letter-spacing: -0.2px;
        }

        .notification-desc {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .notification-time {
            font-size: 12px;
            color: #9ca3af;
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(156, 163, 175, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
            width: fit-content;
        }

        .time-icon {
            width: 12px;
            height: 12px;
            opacity: 0.7;
        }

        /* 通知底部操作 */
        .notification-center-footer {
            padding: 20px 24px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-top: 1px solid rgba(0, 0, 0, 0.06);
            display: flex;
            gap: 16px;
        }

        .notification-footer-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .notification-footer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .notification-footer-btn:hover::before {
            left: 100%;
        }

        .notification-footer-btn.secondary {
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .notification-footer-btn.secondary:hover {
            background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(103, 126, 234, 0.15);
        }

        .notification-footer-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8B5CF6 100%);
            color: white;
            border: 2px solid transparent;
            box-shadow: 0 4px 16px rgba(103, 126, 234, 0.3);
        }

        .notification-footer-btn.primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 12px 32px rgba(103, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a67d8 0%, #667eea 50%, #764ba2 100%);
        }

        .notification-footer-btn:active {
            transform: translateY(0) scale(0.98);
        }

        /* 空状态 */
        .empty-notifications {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-notifications-icon {
            font-size: 56px;
            margin-bottom: 20px;
            opacity: 0.6;
            display: inline-block;
            animation: emptyFloat 4s ease-in-out infinite;
        }

        @keyframes emptyFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .empty-notifications-title {
            font-size: 18px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .empty-notifications-desc {
            font-size: 14px;
            line-height: 1.6;
            max-width: 280px;
            margin: 0 auto;
        }

        /* 响应式设计 */
        @media (max-width: 480px) {
            .notification-center-modal {
                padding: 12px;
                padding-top: 40px;
            }
            
            .notification-center-content {
                border-radius: 20px;
                max-height: 80vh;
            }
            
            .notification-center-header {
                padding: 20px 20px 16px 20px;
            }
            
            .notification-center-title {
                font-size: 18px;
            }
            
            .notification-item {
                padding: 14px 16px;
            }
            
            .notification-icon {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .notification-center-footer {
                padding: 14px 16px;
            }
        }

        /* 移除重复的通知中心按钮 - 如果存在多个，只保留一个 */
        .notification-btn + .notification-btn {
            display: none;
        }

        /* 通知徽章样式优化 */
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-radius: 50%;
            min-width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            animation: badgePulse 2s infinite;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .notification-badge.hidden {
            display: none;
        }

        /* 通知中心触发按钮优化 */
        .notification-trigger {
            position: relative;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .notification-trigger:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .notification-trigger:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 顶部导航 -->
    <div class="gradient-bg px-6 py-6 text-white">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all" onclick="navigateBack()">
                    <i class="fas fa-arrow-left text-sm"></i>
                </button>
                <div>
                    <h1 class="text-xl font-bold">家长控制面板</h1>
                    <p class="text-xs opacity-80">管理孩子的学习进度和设置</p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <button class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all relative" onclick="openNotificationCenter()">
                    <i class="fas fa-bell text-sm"></i>
                    <div class="notification-badge">3</div>
                </button>
                <button class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all" onclick="showHelp()">
                    <i class="fas fa-question text-sm"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 主要内容 -->
    <div class="panel-container">
        <!-- 面板头部 -->
        <div class="panel-header loading-animation">
            <div class="child-profile">
                <div class="child-avatar">👦</div>
                <div class="child-info">
                    <h3>小明的学习档案</h3>
                    <div class="child-status">
                        <div class="status-dot"></div>
                        <span>正在学习中</span>
                        <span>·</span>
                        <span>今日已学习 45分钟</span>
                    </div>
                </div>
            </div>
            
            <div class="quick-stats">
                <div class="quick-stat">
                    <div class="quick-stat-value" id="weeklyTime">12.5h</div>
                    <div class="quick-stat-label">本周学习</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="completedTasks">25</div>
                    <div class="quick-stat-label">完成任务</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="currentLevel">15</div>
                    <div class="quick-stat-label">当前等级</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="totalBadges">8</div>
                    <div class="quick-stat-label">获得勋章</div>
                </div>
            </div>
        </div>

        <!-- 标签导航 -->
        <div class="dashboard-tabs">
            <div class="dashboard-tab active" onclick="switchTab('overview')">
                <i class="fas fa-chart-pie mr-2"></i>
                概览
            </div>
            <div class="dashboard-tab" onclick="switchTab('progress')">
                <i class="fas fa-chart-line mr-2"></i>
                学习进度
            </div>
            <div class="dashboard-tab" onclick="switchTab('control')">
                <i class="fas fa-cog mr-2"></i>
                学习控制
            </div>
            <div class="dashboard-tab" onclick="switchTab('settings')">
                <i class="fas fa-sliders-h mr-2"></i>
                设置
            </div>
        </div>

        <!-- 概览标签 -->
        <div class="tab-content active" id="overview-tab">
            <!-- 重要提醒 -->
            <div class="alert-card loading-animation">
                <div class="alert-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">今日学习提醒</div>
                    <div class="alert-desc">距离今日学习目标还差15分钟，建议完成一个创意表达任务。</div>
                </div>
            </div>

            <div class="overview-grid">
                <!-- 学习概况 -->
                <div class="overview-card loading-animation" style="animation-delay: 0.2s">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #3B82F6, #1E40AF); color: white;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <div class="card-title">学习概况</div>
                            <div class="card-subtitle">本周学习表现总结</div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-item">
                            <span class="progress-label">表达能力</span>
                            <span class="progress-value">88分</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" data-target="88"></div>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">阅读理解</span>
                            <span class="progress-value">82分</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" data-target="82"></div>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">创意思维</span>
                            <span class="progress-value">92分</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" data-target="92"></div>
                        </div>
                    </div>
                </div>

                <!-- 最近活动 -->
                <div class="overview-card loading-animation" style="animation-delay: 0.4s">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #10B981, #059669); color: white;">
                            <i class="fas fa-history"></i>
                        </div>
                        <div>
                            <div class="card-title">最近活动</div>
                            <div class="card-subtitle">孩子的学习记录</div>
                        </div>
                    </div>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #3B82F6, #60A5FA); color: white;">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">完成创意表达挑战</div>
                                <div class="activity-time">15分钟前</div>
                            </div>
                            <div class="activity-score">90分</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #10B981, #34D399); color: white;">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">阅读故事《小兔历险记》</div>
                                <div class="activity-time">1小时前</div>
                            </div>
                            <div class="activity-score">85分</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #F59E0B, #FBBF24); color: white;">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">获得"创意大师"勋章</div>
                                <div class="activity-time">2小时前</div>
                            </div>
                            <div class="activity-score">+50经验</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #8B5CF6, #A78BFA); color: white;">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">与AI助手对话练习</div>
                                <div class="activity-time">3小时前</div>
                            </div>
                            <div class="activity-score">88分</div>
                        </div>
                    </div>
                </div>

                <!-- 成就展示 -->
                <div class="overview-card loading-animation" style="animation-delay: 0.6s">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white;">
                            <i class="fas fa-award"></i>
                        </div>
                        <div>
                            <div class="card-title">最新成就</div>
                            <div class="card-subtitle">孩子获得的勋章</div>
                        </div>
                    </div>
                    <div class="achievement-showcase">
                        <div class="achievement-badge earned">
                            <div class="achievement-emoji">🎨</div>
                            <div class="achievement-name">创意大师</div>
                        </div>
                        <div class="achievement-badge earned">
                            <div class="achievement-emoji">📚</div>
                            <div class="achievement-name">阅读之星</div>
                        </div>
                        <div class="achievement-badge earned">
                            <div class="achievement-emoji">⚡</div>
                            <div class="achievement-name">坚持之王</div>
                        </div>
                        <div class="achievement-badge">
                            <div class="achievement-emoji">🌟</div>
                            <div class="achievement-name">表达专家</div>
                        </div>
                    </div>
                </div>

                <!-- AI分析建议 -->
                <div class="overview-card loading-animation" style="animation-delay: 0.8s">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white;">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <div class="card-title">AI智能建议</div>
                            <div class="card-subtitle">个性化学习指导</div>
                        </div>
                    </div>
                    <div style="padding: 16px 0;">
                        <div style="background: #f8fafc; border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                            <div style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px;">
                                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                                学习建议
                            </div>
                            <div style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                孩子在创意思维方面表现出色，建议增加更多创作类任务来发挥优势。
                            </div>
                        </div>
                        <div style="background: #f8fafc; border-radius: 8px; padding: 12px;">
                            <div style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px;">
                                <i class="fas fa-clock text-blue-500 mr-2"></i>
                                时间建议
                            </div>
                            <div style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                建议每天学习时间控制在30-45分钟，保持学习的连续性和趣味性。
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 学习进度标签 -->
        <div class="tab-content" id="progress-tab">
            <div class="report-section loading-animation">
                <div class="chart-title">
                    <div class="chart-title-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <span>7天学习趋势</span>
                </div>
                <div class="chart-container">
                    <div class="chart-bars">
                        <div class="chart-bar" data-value="72" style="height: 60%;"></div>
                        <div class="chart-bar" data-value="76" style="height: 70%;"></div>
                        <div class="chart-bar" data-value="74" style="height: 65%;"></div>
                        <div class="chart-bar" data-value="82" style="height: 80%;"></div>
                        <div class="chart-bar" data-value="85" style="height: 85%;"></div>
                        <div class="chart-bar" data-value="88" style="height: 90%;"></div>
                        <div class="chart-bar" data-value="90" style="height: 95%;"></div>
                    </div>
                    <div class="chart-labels">
                        <div class="chart-label">周一</div>
                        <div class="chart-label">周二</div>
                        <div class="chart-label">周三</div>
                        <div class="chart-label">周四</div>
                        <div class="chart-label">周五</div>
                        <div class="chart-label">周六</div>
                        <div class="chart-label">周日</div>
                    </div>
                </div>
                
                <!-- 添加图表说明 -->
                <div style="background: #F8FAFC; border-radius: 8px; padding: 12px; margin-top: 16px;">
                    <div style="font-size: 12px; color: #6B7280; text-align: center;">
                        <i class="fas fa-info-circle mr-1"></i>
                        图表显示孩子近7天的综合学习表现评分（满分100分）
                    </div>
                </div>
            </div>

            <div class="overview-grid">
                <div class="overview-card loading-animation" style="animation-delay: 0.2s">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #06B6D4, #0891B2); color: white;">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div>
                            <div class="card-title">任务完成情况</div>
                            <div class="card-subtitle">各类型任务进度</div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-item">
                            <span class="progress-label">表达能力任务</span>
                            <span class="progress-value">15/20</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" data-target="75"></div>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">阅读理解任务</span>
                            <span class="progress-value">12/15</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" data-target="80"></div>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">创意思维任务</span>
                            <span class="progress-value">8/10</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%" data-target="80"></div>
                        </div>
                    </div>
                </div>

                <div class="overview-card loading-animation" style="animation-delay: 0.4s">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #EC4899, #DB2777); color: white;">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div>
                            <div class="card-title">学习时长统计</div>
                            <div class="card-subtitle">每日学习时间记录</div>
                        </div>
                    </div>
                    <div style="padding: 16px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span style="font-size: 13px; color: #374151;">今日学习</span>
                            <span style="font-size: 16px; font-weight: 600; color: #EC4899;">45分钟</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span style="font-size: 13px; color: #374151;">本周平均</span>
                            <span style="font-size: 16px; font-weight: 600; color: #EC4899;">38分钟</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span style="font-size: 13px; color: #374151;">本月总计</span>
                            <span style="font-size: 16px; font-weight: 600; color: #EC4899;">12.5小时</span>
                        </div>
                        <div style="background: linear-gradient(135deg, #FDF2F8, #FCE7F3); border-radius: 8px; padding: 12px; margin-top: 16px;">
                            <div style="font-size: 12px; color: #831843; text-align: center;">
                                <i class="fas fa-trophy mr-1"></i>
                                连续学习7天，表现优秀！
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 学习控制标签 -->
        <div class="tab-content" id="control-tab">
            <div class="control-grid">
                <div class="control-card loading-animation" onclick="pauseLearning()">
                    <div class="control-icon">
                        <i class="fas fa-pause"></i>
                    </div>
                    <div class="control-title">暂停学习</div>
                    <div class="control-desc">临时暂停孩子的学习活动</div>
                </div>

                <div class="control-card loading-animation" onclick="setLearningGoal()">
                    <div class="control-icon">
                        <i class="fas fa-target"></i>
                    </div>
                    <div class="control-title">设置目标</div>
                    <div class="control-desc">制定每日学习时间和任务目标</div>
                </div>

                <div class="control-card loading-animation" onclick="viewDetailedReport()">
                    <div class="control-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="control-title">详细报告</div>
                    <div class="control-desc">查看完整的学习分析报告</div>
                </div>

                <div class="control-card loading-animation" onclick="manageContent()">
                    <div class="control-icon">
                        <i class="fas fa-filter"></i>
                    </div>
                    <div class="control-title">内容管理</div>
                    <div class="control-desc">选择适合的学习内容和难度</div>
                </div>

                <div class="control-card loading-animation" onclick="setRewards()">
                    <div class="control-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="control-title">奖励机制</div>
                    <div class="control-desc">设置学习奖励和激励措施</div>
                </div>

                <div class="control-card loading-animation" onclick="navigateToPage('family-center')">
                    <div class="control-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="control-title">家庭互动中心</div>
                    <div class="control-desc">进入家庭协作学习乐园</div>
                </div>
                
                <div class="control-card loading-animation" onclick="navigateToPage('collaborative-learning')">
                    <div class="control-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div class="control-title">协作学习</div>
                    <div class="control-desc">启动亲子协作学习活动</div>
                </div>
            </div>
        </div>

        <!-- 设置标签 -->
        <div class="tab-content" id="settings-tab">
            <!-- 学习时间设置 -->
            <div class="settings-section loading-animation">
                <div class="settings-title">
                    <i class="fas fa-clock text-blue-500"></i>
                    学习时间管理
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">每日学习时间限制</div>
                        <div class="setting-desc">控制孩子每天的最大学习时长</div>
                    </div>
                    <div class="time-control">
                        <input type="number" class="time-input" value="60" min="15" max="120">
                        <span style="font-size: 12px; color: #6b7280;">分钟</span>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">学习提醒</div>
                        <div class="setting-desc">定时提醒孩子进行学习活动</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">休息提醒</div>
                        <div class="setting-desc">学习30分钟后提醒休息</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <!-- 安全设置 -->
            <div class="settings-section loading-animation" style="animation-delay: 0.2s">
                <div class="settings-title">
                    <i class="fas fa-shield-alt text-green-500"></i>
                    安全与隐私
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">数据共享</div>
                        <div class="setting-desc">允许与其他家长分享学习成果</div>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">位置服务</div>
                        <div class="setting-desc">获取位置信息以提供本地化内容</div>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">语音录制</div>
                        <div class="setting-desc">允许录制语音用于发音练习</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <!-- 通知设置 -->
            <div class="settings-section loading-animation" style="animation-delay: 0.4s">
                <div class="settings-title">
                    <i class="fas fa-bell text-yellow-500"></i>
                    通知设置
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">学习进度通知</div>
                        <div class="setting-desc">接收孩子学习进度的推送通知</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">成就通知</div>
                        <div class="setting-desc">孩子获得新成就时通知家长</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">学习报告</div>
                        <div class="setting-desc">每周自动发送学习总结报告</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <!-- 内容管理 -->
            <div class="settings-section loading-animation" style="animation-delay: 0.6s">
                <div class="settings-title">
                    <i class="fas fa-filter text-purple-500"></i>
                    内容管理
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">难度自适应</div>
                        <div class="setting-desc">根据孩子能力自动调整任务难度</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">内容筛选</div>
                        <div class="setting-desc">过滤不适合的学习内容</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">个性化推荐</div>
                        <div class="setting-desc">基于学习偏好推荐合适内容</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <!-- 家长控制 -->
            <div class="settings-section loading-animation" style="animation-delay: 0.8s">
                <div class="settings-title">
                    <i class="fas fa-user-shield text-red-500"></i>
                    家长控制
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">远程暂停</div>
                        <div class="setting-desc">随时远程暂停孩子的学习活动</div>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">使用时间统计</div>
                        <div class="setting-desc">详细记录每日使用时长</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">紧急联系</div>
                        <div class="setting-desc">遇到问题时快速联系家长</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <!-- 账号管理 -->
            <div class="settings-section loading-animation" style="animation-delay: 1.0s">
                <div class="settings-title">
                    <i class="fas fa-user-cog text-blue-600"></i>
                    账号管理
                </div>
                
                <div class="setting-item clickable" onclick="navigateToAccountCenter()">
                    <div class="setting-info">
                        <div class="setting-label">账号中心</div>
                        <div class="setting-desc">管理账号信息、会员等级和充值</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: #9ca3af;"></i>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">自动续费</div>
                        <div class="setting-desc">会员到期前自动续费</div>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this)"></div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-label">消费提醒</div>
                        <div class="setting-desc">充值和消费时发送通知提醒</div>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 浮动操作按钮 -->
    <div class="floating-actions">
        <!-- 紧急控制按钮 -->
        <div class="fab-button emergency" onclick="showEmergencyControls()" title="紧急控制">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        
        <!-- 快速报告按钮 -->
        <div class="fab-button report" onclick="generateQuickReport()" title="智能生成学习报告">
            <i class="fas fa-file-alt"></i>
            <div class="report-badge hidden" id="reportBadge">
                <i class="fas fa-plus"></i>
            </div>
        </div>
        
        <!-- 实时监控按钮 -->
        <div class="fab-button monitor" onclick="toggleRealTimeMonitor()" title="实时监控">
            <i class="fas fa-eye"></i>
            <div class="monitor-status" id="monitorStatus"></div>
        </div>
        
        <!-- 快速设置按钮 -->
        <div class="fab-button settings" onclick="showQuickSettings()" title="快速设置">
            <i class="fas fa-cog"></i>
        </div>
    </div>

    <!-- 紧急控制面板 -->
    <div class="emergency-panel" id="emergencyPanel">
        <div class="emergency-content">
            <div class="emergency-header">
                <div class="emergency-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="emergency-title">紧急控制中心</div>
                <button class="emergency-close" onclick="closeEmergencyPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="emergency-actions">
                <!-- 立即暂停学习 -->
                <div class="emergency-action critical" onclick="emergencyPause()">
                    <div class="action-icon">
                        <i class="fas fa-pause-circle"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">立即暂停学习</div>
                        <div class="action-desc">暂停所有学习活动</div>
                    </div>
                    <div class="action-status" id="pauseStatus">未暂停</div>
                </div>
                
                <!-- 锁定设备 -->
                <div class="emergency-action warning" onclick="lockDevice()">
                    <div class="action-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">锁定学习设备</div>
                        <div class="action-desc">阻止继续使用应用</div>
                    </div>
                    <div class="action-status" id="lockStatus">未锁定</div>
                </div>
                
                <!-- 发送消息 -->
                <div class="emergency-action info" onclick="sendUrgentMessage()">
                    <div class="action-icon">
                        <i class="fas fa-comment-alt"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">发送紧急消息</div>
                        <div class="action-desc">向孩子发送重要通知</div>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- 查看位置 -->
                <div class="emergency-action info" onclick="checkLocation()">
                    <div class="action-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">查看设备位置</div>
                        <div class="action-desc">获取当前设备位置</div>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- 联系孩子 -->
                <div class="emergency-action urgent" onclick="contactChild()">
                    <div class="action-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">紧急联系孩子</div>
                        <div class="action-desc">发起语音/视频通话</div>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- 恢复正常 -->
                <div class="emergency-action success" onclick="restoreNormal()">
                    <div class="action-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">恢复正常学习</div>
                        <div class="action-desc">解除所有限制</div>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
            
            <!-- 紧急联系人 -->
            <div class="emergency-contacts">
                <div class="contacts-title">紧急联系人</div>
                <div class="contacts-list">
                    <div class="contact-item" onclick="callContact('mom')">
                        <div class="contact-avatar">👩</div>
                        <div class="contact-info">
                            <div class="contact-name">妈妈</div>
                            <div class="contact-phone">138****5678</div>
                        </div>
                        <div class="contact-action">
                            <i class="fas fa-phone"></i>
                        </div>
                    </div>
                    
                    <div class="contact-item" onclick="callContact('dad')">
                        <div class="contact-avatar">👨</div>
                        <div class="contact-info">
                            <div class="contact-name">爸爸</div>
                            <div class="contact-phone">139****1234</div>
                        </div>
                        <div class="contact-action">
                            <i class="fas fa-phone"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 快速设置面板 -->
    <div class="quick-settings-panel" id="quickSettingsPanel">
        <div class="quick-settings-content">
            <div class="quick-settings-header">
                <div class="settings-title">快速设置</div>
                <button class="settings-close" onclick="closeQuickSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="quick-settings-grid">
                <!-- 学习时间控制 -->
                <div class="quick-setting-item">
                    <div class="setting-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="setting-content">
                        <div class="setting-label">每日学习时间</div>
                        <div class="setting-control">
                            <button class="time-btn" onclick="adjustTime(-15)">-15分</button>
                            <span class="time-display" id="dailyTimeLimit">60分钟</span>
                            <button class="time-btn" onclick="adjustTime(15)">+15分</button>
                        </div>
                    </div>
                </div>
                
                <!-- 难度调整 -->
                <div class="quick-setting-item">
                    <div class="setting-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="setting-content">
                        <div class="setting-label">学习难度</div>
                        <div class="setting-control">
                            <select class="difficulty-select" id="difficultyLevel" onchange="changeDifficulty()">
                                <option value="easy">简单</option>
                                <option value="medium" selected>中等</option>
                                <option value="hard">困难</option>
                                <option value="auto">自适应</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 内容筛选 -->
                <div class="quick-setting-item">
                    <div class="setting-icon">
                        <i class="fas fa-filter"></i>
                    </div>
                    <div class="setting-content">
                        <div class="setting-label">内容筛选</div>
                        <div class="setting-control">
                            <div class="filter-tags">
                                <span class="filter-tag active" onclick="toggleFilter('expression')">表达</span>
                                <span class="filter-tag active" onclick="toggleFilter('reading')">阅读</span>
                                <span class="filter-tag active" onclick="toggleFilter('creativity')">创意</span>
                                <span class="filter-tag" onclick="toggleFilter('advanced')">高级</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 提醒设置 -->
                <div class="quick-setting-item">
                    <div class="setting-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="setting-content">
                        <div class="setting-label">学习提醒</div>
                        <div class="setting-control">
                            <div class="reminder-times">
                                <input type="time" class="time-input" value="09:00" onchange="setReminder(0, this.value)">
                                <input type="time" class="time-input" value="19:00" onchange="setReminder(1, this.value)">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 奖励机制 -->
                <div class="quick-setting-item">
                    <div class="setting-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="setting-content">
                        <div class="setting-label">奖励设置</div>
                        <div class="setting-control">
                            <div class="reward-options">
                                <label class="reward-option">
                                    <input type="checkbox" checked> 完成任务奖励
                                </label>
                                <label class="reward-option">
                                    <input type="checkbox" checked> 连续学习奖励
                                </label>
                                <label class="reward-option">
                                    <input type="checkbox"> 超额完成奖励
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 安全模式 -->
                <div class="quick-setting-item">
                    <div class="setting-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="setting-content">
                        <div class="setting-label">安全模式</div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="safeMode" checked onchange="toggleSafeMode()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="quick-settings-actions">
                <button class="settings-btn secondary" onclick="resetToDefault()">恢复默认</button>
                <button class="settings-btn primary" onclick="saveQuickSettings()">保存设置</button>
            </div>
        </div>
    </div>

    <!-- 实时监控面板 -->
    <div class="monitor-panel" id="monitorPanel">
        <div class="monitor-content">
            <div class="monitor-header">
                <div class="monitor-title">
                    <i class="fas fa-eye"></i>
                    <span>实时监控</span>
                </div>
                <button class="monitor-close" onclick="closeMonitorPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="monitor-body">
                <!-- 实时状态 -->
                <div class="monitor-section">
                    <div class="monitor-section-title">当前状态</div>
                    <div class="monitor-stats-grid">
                        <div class="monitor-stat">
                            <div class="monitor-stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="monitor-stat-info">
                                <div class="monitor-stat-label">会话时长</div>
                                <div class="monitor-stat-value" id="currentSessionTime">23分45秒</div>
                            </div>
                        </div>
                        
                        <div class="monitor-stat">
                            <div class="monitor-stat-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="monitor-stat-info">
                                <div class="monitor-stat-label">已完成任务</div>
                                <div class="monitor-stat-value" id="tasksCompleted">3/5</div>
                            </div>
                        </div>
                        
                        <div class="monitor-stat">
                            <div class="monitor-stat-icon">
                                <i class="fas fa-battery-three-quarters"></i>
                            </div>
                            <div class="monitor-stat-info">
                                <div class="monitor-stat-label">设备电量</div>
                                <div class="monitor-stat-value" id="deviceBattery">85%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 活动时间线 -->
                <div class="monitor-section">
                    <div class="monitor-section-title">最近活动</div>
                    <div class="activity-timeline" id="activityTimeline">
                        <div class="timeline-item">
                            <div class="timeline-time">13:25</div>
                            <div class="timeline-content">
                                <div class="timeline-action">完成阅读任务</div>
                                <div class="timeline-score">获得 +30 经验值</div>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">13:20</div>
                            <div class="timeline-content">
                                <div class="timeline-action">与AI助手对话</div>
                                <div class="timeline-score">练习口语表达</div>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">13:15</div>
                            <div class="timeline-content">
                                <div class="timeline-action">开始学习会话</div>
                                <div class="timeline-score">进入专注模式</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 监控警告 -->
                <div class="monitor-section">
                    <div class="monitor-section-title">智能提醒</div>
                    <div class="monitor-alerts">
                        <!-- 警告项会动态添加到这里 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 优化后的通知中心HTML结构 -->
    <div class="notification-center-modal" id="notificationCenterModal">
        <div class="notification-center-content">
            <!-- 通知中心头部 -->
            <div class="notification-center-header">
                <div class="notification-header-top">
                    <div class="notification-center-title">
                        <div class="notification-title-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <span>通知中心</span>
                    </div>
                    <button class="notification-close-btn" onclick="closeNotificationCenter()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="notification-stats">
                    <div class="notification-stat">
                        <div class="stat-dot unread"></div>
                        <span>3条未读</span>
                    </div>
                    <div class="notification-stat">
                        <div class="stat-dot"></div>
                        <span>今日8条</span>
                    </div>
                </div>
            </div>

            <!-- 筛选标签 -->
            <div class="notification-filters">
                <button class="notification-filter active" onclick="filterNotifications('all')">
                    全部
                </button>
                <button class="notification-filter" onclick="filterNotifications('child-activity')">
                    孩子动态
                </button>
                <button class="notification-filter" onclick="filterNotifications('system')">
                    系统消息
                </button>
                <button class="notification-filter" onclick="filterNotifications('achievement')">
                    成就通知
                </button>
                <button class="notification-filter" onclick="filterNotifications('alert')">
                    重要提醒
                </button>
            </div>

            <!-- 通知列表 -->
            <div class="notification-list-container">
                <div class="notification-item unread" data-type="child-activity" onclick="markAsRead(this)">
                    <div class="notification-icon child-activity">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">孩子完成了今日学习任务</div>
                        <div class="notification-desc">小明完成了表达能力练习，获得了85分的好成绩！</div>
                        <div class="notification-time">
                            <i class="fas fa-clock time-icon"></i>
                            <span>5分钟前</span>
                        </div>
                    </div>
                </div>

                <div class="notification-item unread" data-type="achievement" onclick="markAsRead(this)">
                    <div class="notification-icon achievement">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">孩子获得新勋章！</div>
                        <div class="notification-desc">恭喜小明获得了"创意大师"勋章，继续保持哦！</div>
                        <div class="notification-time">
                            <i class="fas fa-clock time-icon"></i>
                            <span>1小时前</span>
                        </div>
                    </div>
                </div>

                <div class="notification-item unread" data-type="alert" onclick="markAsRead(this)">
                    <div class="notification-icon alert">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">学习时间提醒</div>
                        <div class="notification-desc">今天的学习时间已达到30分钟，建议让孩子休息一下</div>
                        <div class="notification-time">
                            <i class="fas fa-clock time-icon"></i>
                            <span>2小时前</span>
                        </div>
                    </div>
                </div>

                <div class="notification-item" data-type="system" onclick="markAsRead(this)">
                    <div class="notification-icon system">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">系统更新提醒</div>
                        <div class="notification-desc">萌芽AI已更新至最新版本，新增了更多有趣的学习功能</div>
                        <div class="notification-time">
                            <i class="fas fa-clock time-icon"></i>
                            <span>1天前</span>
                        </div>
                    </div>
                </div>

                <div class="notification-item" data-type="report" onclick="markAsRead(this)">
                    <div class="notification-icon report">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">本周学习报告已生成</div>
                        <div class="notification-desc">小明本周学习表现优秀，详细报告已发送至您的邮箱</div>
                        <div class="notification-time">
                            <i class="fas fa-clock time-icon"></i>
                            <span>2天前</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 底部操作 -->
            <div class="notification-center-footer">
                <button class="notification-footer-btn secondary" onclick="markAllAsRead()">
                    <i class="fas fa-check"></i>
                    全部已读
                </button>
                <button class="notification-footer-btn primary" onclick="openNotificationSettings()">
                    <i class="fas fa-cog"></i>
                    通知设置
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentChildData = {};
        let realTimeUpdates = true;

        // 页面初始化 - 使用统一管理系统
        MengyaUtils.Lifecycle.onInit(() => {
            initializeParentPanelWithGlobalData();
            loadChildDataFromGlobal();
            startRealTimeUpdates();
            setupEventListeners();
            setupChartInteractions();
        });
        
        // 使用全局数据初始化
        async function initializeParentPanelWithGlobalData() {
            // 同步最新数据
            MengyaUtils.Data.syncData(true);
            
            // 传统初始化
            animateElements();
            updateStatistics();
            loadParentSettingsFromGlobal();
            setupTabNavigation();
            
            // 如果默认显示进度标签，启动图表动画
            setTimeout(() => {
                if (document.getElementById('progress-tab').classList.contains('active')) {
                    animateChart();
                }
            }, 1500);
        }
        
        // 从全局数据加载家长设置
        async function loadParentSettingsFromGlobal() {
            const parentSettings = await MengyaUtils.Data.getData('parent.settings');
            if (parentSettings) {
                applyParentSettings(parentSettings);
            }
            loadSettings(); // 保持原有逻辑
        }
        
        // 从全局数据加载孩子信息
        async function loadChildDataFromGlobal() {
            const childProfile = await MengyaUtils.Data.getData('child.profile');
            const childProgress = await MengyaUtils.Data.getData('child.progress');
            
            // 合并全局数据和本地数据
            if (childProfile || childProgress) {
                currentChildData = {
                    ...currentChildData,
                    ...(childProfile || {}),
                    ...(childProgress || {}),
                    name: childProfile?.nickname || '小明',
                    level: childProgress?.level || 15,
                    weeklyTime: childProgress?.weeklyTime || 12.5,
                    completedTasks: childProgress?.completedTasks || 25,
                    totalBadges: childProgress?.totalBadges || 8
                };
            } else {
                // 如果没有全局数据，使用默认数据
                loadChildData();
            }
            
            updateDashboardData();
        }

        // 初始化家长面板
        function initializeParentPanel() {
            animateElements();
            updateStatistics();
            loadSettings();
            setupTabNavigation();
            
            // 如果默认显示进度标签，启动图表动画
            setTimeout(() => {
                if (document.getElementById('progress-tab').classList.contains('active')) {
                    animateChart();
                }
            }, 1500);
        }

        // 元素动画
        function animateElements() {
            const elements = document.querySelectorAll('.loading-animation');
            elements.forEach((element, index) => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    element.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 150);
            });
        }

        // 标签切换
        function switchTab(tabName) {
            // 更新标签状态
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 显示对应内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');

            // 如果切换到进度标签，启动图表动画
            if (tabName === 'progress') {
                animateChart();
                animateProgressBars(); // 也触发进度条动画
            }
            
            // 添加切换动画效果
            const activeTab = document.getElementById(tabName + '-tab');
            activeTab.style.opacity = '0';
            activeTab.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                activeTab.style.transition = 'all 0.4s ease';
                activeTab.style.opacity = '1';
                activeTab.style.transform = 'translateY(0)';
            }, 100);

            showNotification(`已切换到${getTabName(tabName)}`, 'info');
        }

        // 获取标签名称
        function getTabName(tabName) {
            const names = {
                'overview': '概览',
                'progress': '学习进度',
                'control': '学习控制',
                'settings': '设置'
            };
            return names[tabName] || '概览';
        }

        // 加载孩子数据
        function loadChildData() {
            // 模拟数据加载
            currentChildData = {
                name: '小明',
                level: 15,
                weeklyTime: 12.5,
                completedTasks: 25,
                totalBadges: 8,
                abilities: {
                    expression: 88,
                    reading: 82,
                    creativity: 92,
                    communication: 78
                },
                recentActivities: [
                    { type: 'task', name: '创意表达挑战', score: 90, time: '15分钟前' },
                    { type: 'reading', name: '阅读故事《小兔历险记》', score: 85, time: '1小时前' },
                    { type: 'achievement', name: '获得"创意大师"勋章', score: '+50经验', time: '2小时前' }
                ]
            };

            updateDashboardData();
        }

        // 更新仪表板数据
        function updateDashboardData() {
            // 更新统计数据
            animateNumber('weeklyTime', currentChildData.weeklyTime);
            animateNumber('completedTasks', currentChildData.completedTasks);
            animateNumber('currentLevel', currentChildData.level);
            animateNumber('totalBadges', currentChildData.totalBadges);

            // 更新进度条
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => {
                    const target = bar.getAttribute('data-target');
                    if (target) {
                        bar.style.width = target + '%';
                    }
                });
            }, 1000);
        }

        // 数字动画
        function animateNumber(elementId, target) {
            const element = document.getElementById(elementId);
            if (!element) return;

            let current = 0;
            const increment = target / 50;
            const isFloat = target % 1 !== 0;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                
                if (isFloat) {
                    element.textContent = current.toFixed(1) + 'h';
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 40);
        }

        // 切换设置
        function toggleSetting(toggleElement) {
            const isActive = toggleElement.classList.contains('active');
            
            if (isActive) {
                toggleElement.classList.remove('active');
                showNotification('设置已关闭', 'info');
            } else {
                toggleElement.classList.add('active');
                showNotification('设置已开启', 'success');
            }

            // 添加点击动画
            createRippleEffect(toggleElement, event);
            vibrateDevice([50]);

            // 保存设置
            saveSettings();
        }

        // 暂停学习
        function pauseLearning() {
            const confirmed = confirm('确定要暂停孩子的学习活动吗？');
            if (confirmed) {
                showNotification('正在暂停学习活动...', 'warning');
                
                setTimeout(() => {
                    // 更新状态显示
                    updateLearningStatus('paused');
                    showNotification('学习活动已暂停。孩子的设备将显示暂停提示。', 'success');
                    
                    // 震动反馈
                    vibrateDevice([200, 100, 200]);
                    
                    // 记录操作
                    logParentAction('pause_learning', '家长暂停了学习活动');
                }, 1500);
            }
        }

        // 设置学习目标
        function setLearningGoal() {
            const goalModal = `
                <div style="background: white; border-radius: 16px; padding: 24px; max-width: 400px; margin: 20px;">
                    <h3 style="margin-bottom: 20px; color: #374151; font-size: 18px; font-weight: 600;">
                        <i class="fas fa-target text-blue-500 mr-2"></i>设置学习目标
                    </h3>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">每日学习时间 (分钟)</label>
                        <input type="number" id="dailyTimeGoal" value="60" min="15" max="180" 
                               style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">每日任务数量</label>
                        <input type="number" id="dailyTaskGoal" value="3" min="1" max="10"
                               style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">学习提醒时间</label>
                        <input type="time" id="reminderTime" value="19:00"
                               style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">重点提升能力</label>
                        <select id="focusArea" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            <option value="expression">表达能力</option>
                            <option value="reading">阅读理解</option>
                            <option value="creativity">创意思维</option>
                            <option value="communication">沟通交流</option>
                            <option value="balanced">均衡发展</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeGoalModal()" 
                                style="flex: 1; padding: 12px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            取消
                        </button>
                        <button onclick="saveGoalSettings()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(135deg, #3B82F6, #1E40AF); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            保存目标
                        </button>
                    </div>
                </div>
            `;
            
            showModal(goalModal);
        }

        // 保存目标设置
        function saveGoalSettings() {
            const dailyTime = document.getElementById('dailyTimeGoal').value;
            const dailyTasks = document.getElementById('dailyTaskGoal').value;
            const reminderTime = document.getElementById('reminderTime').value;
            const focusArea = document.getElementById('focusArea').value;
            
            const goals = {
                dailyTime: parseInt(dailyTime),
                dailyTasks: parseInt(dailyTasks),
                reminderTime: reminderTime,
                focusArea: focusArea,
                createdAt: Date.now()
            };
            
            // 保存到本地存储
            localStorage.setItem('learningGoals', JSON.stringify(goals));
            
            closeModal();
            showNotification(`学习目标已设置：每日${dailyTime}分钟，完成${dailyTasks}个任务`, 'success');
            
            // 更新显示
            updateGoalDisplay(goals);
            
            // 记录操作
            logParentAction('set_goals', `设置学习目标: ${dailyTime}分钟/${dailyTasks}任务`);
        }

        // 查看详细报告
        function viewDetailedReport() {
            showNotification('正在生成详细报告...', 'info');
            
            // 添加按钮点击动画效果
            const button = event.currentTarget;
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = '';
            }, 150);
            
            // 震动反馈
            if (navigator.vibrate) {
                navigator.vibrate([50]);
            }
            
            // 保存报告数据到本地存储，供报告页面使用
            const reportData = {
                type: 'parent_report', // 标记为家长报告
                studentInfo: {
                    name: currentChildData.name,
                    age: currentChildData.age,
                    level: currentChildData.level,
                    reportDate: new Date().toISOString()
                },
                weeklyStats: {
                    totalStudyTime: '12小时30分钟',
                    tasksCompleted: 25,
                    averageDailyTime: '1小时47分钟',
                    consecutiveDays: 7,
                    weeklyGoalCompletion: '85%'
                },
                abilityScores: {
                    expression: {
                        current: 88,
                        previous: 76,
                        improvement: '+12'
                    },
                    reading: {
                        current: 82,
                        previous: 74,
                        improvement: '+8'
                    },
                    creativity: {
                        current: 92,
                        previous: 74,
                        improvement: '+18'
                    },
                    communication: {
                        current: 78,
                        previous: 72,
                        improvement: '+6'
                    }
                },
                dailyProgress: [
                    { date: '2024-03-18', score: 72, tasks: 3, time: '45分钟' },
                    { date: '2024-03-19', score: 76, tasks: 4, time: '52分钟' },
                    { date: '2024-03-20', score: 74, tasks: 2, time: '38分钟' },
                    { date: '2024-03-21', score: 82, tasks: 5, time: '68分钟' },
                    { date: '2024-03-22', score: 85, tasks: 4, time: '55分钟' },
                    { date: '2024-03-23', score: 88, tasks: 3, time: '42分钟' },
                    { date: '2024-03-24', score: 90, tasks: 4, time: '60分钟' }
                ],
                achievements: [
                    {
                        name: '创意大师',
                        description: '完成10个创意任务',
                        earnedDate: '2024-03-20',
                        icon: '🎨'
                    },
                    {
                        name: '阅读之星',
                        description: '阅读20篇文章',
                        earnedDate: '2024-03-18',
                        icon: '📚'
                    },
                    {
                        name: '坚持之王',
                        description: '连续7天学习',
                        earnedDate: '2024-03-21',
                        icon: '⚡'
                    },
                    {
                        name: '表达专家',
                        description: '高质量完成表达任务',
                        earnedDate: '2024-03-22',
                        icon: '💬'
                    }
                ],
                taskDetails: [
                    {
                        category: '创意表达',
                        completed: 10,
                        total: 12,
                        avgScore: 89,
                        bestScore: 95,
                        totalTime: '4小时30分钟'
                    },
                    {
                        category: '阅读理解',
                        completed: 8,
                        total: 10,
                        avgScore: 82,
                        bestScore: 92,
                        totalTime: '3小时15分钟'
                    },
                    {
                        category: '语言游戏',
                        completed: 7,
                        total: 8,
                        avgScore: 86,
                        bestScore: 94,
                        totalTime: '2小时20分钟'
                    },
                    {
                        category: 'AI对话',
                        completed: 15,
                        total: 15,
                        avgScore: 91,
                        bestScore: 96,
                        totalTime: '3小时45分钟'
                    }
                ],
                recommendations: [
                    {
                        type: 'improvement',
                        title: '重点提升：沟通交流',
                        content: '建议多参与AI对话练习，通过日常情景模拟来提升沟通表达能力。可以尝试角色扮演游戏，增加语言表达的多样性。',
                        priority: 'high'
                    },
                    {
                        type: 'strength',
                        title: '强化优势：创意思维',
                        content: '你的创意思维表现出色！建议挑战更高难度的创作任务，尝试不同题材的写作，进一步发挥你的想象力。',
                        priority: 'medium'
                    },
                    {
                        type: 'habit',
                        title: '学习习惯：保持规律',
                        content: '你已经连续7天坚持学习，表现很棒！建议每天固定时间进行15-20分钟的练习，养成良好的学习习惯。',
                        priority: 'low'
                    }
                ],
                parentNotes: '本周小明在创意思维方面表现尤为突出，建议继续鼓励他的想象力发挥。沟通交流能力有待加强，可以增加与家人的日常对话练习。',
                nextWeekGoals: [
                    '完成5个沟通交流任务',
                    '保持每日学习习惯',
                    '尝试1个高难度创意任务',
                    '提升阅读理解速度'
                ],
                generatedAt: Date.now()
            };
            
            // 保存到本地存储
            localStorage.setItem('parentReport', JSON.stringify(reportData));
            
            // 记录操作
            logParentAction('view_detailed_report', '查看详细学习报告');
            
            // 延迟跳转到评估页面（作为家长整体报告页面）
            setTimeout(() => {
                parent.postMessage({
                    type: 'openPage',
                    url: 'evaluation.html'
                }, '*');
            }, 1000);
        }

        // 内容管理功能
        function manageContent() {
            const contentModal = `
                <div style="background: white; border-radius: 16px; padding: 24px; max-width: 450px; margin: 20px;">
                    <h3 style="margin-bottom: 20px; color: #374151; font-size: 18px; font-weight: 600;">
                        <i class="fas fa-filter text-purple-500 mr-2"></i>内容管理设置
                    </h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px; color: #374151; font-size: 14px; font-weight: 600;">难度设置</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                            <button class="difficulty-btn active" data-level="easy" onclick="selectDifficulty('easy')"
                                    style="padding: 8px 12px; border: 2px solid #10B981; background: #10B981; color: white; border-radius: 8px; font-size: 12px; cursor: pointer;">
                                简单
                            </button>
                            <button class="difficulty-btn" data-level="medium" onclick="selectDifficulty('medium')"
                                    style="padding: 8px 12px; border: 2px solid #e5e7eb; background: white; color: #374151; border-radius: 8px; font-size: 12px; cursor: pointer;">
                                中等
                            </button>
                            <button class="difficulty-btn" data-level="hard" onclick="selectDifficulty('hard')"
                                    style="padding: 8px 12px; border: 2px solid #e5e7eb; background: white; color: #374151; border-radius: 8px; font-size: 12px; cursor: pointer;">
                                困难
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px; color: #374151; font-size: 14px; font-weight: 600;">内容类型</h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 表达能力训练
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 阅读理解练习
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 创意思维游戏
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 沟通交流活动
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px; color: #374151; font-size: 14px; font-weight: 600;">内容过滤</h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 过滤不适宜内容
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 启用家长审核
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox"> 仅显示推荐内容
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeModal()" 
                                style="flex: 1; padding: 12px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            取消
                        </button>
                        <button onclick="saveContentSettings()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            保存设置
                        </button>
                    </div>
                </div>
            `;
            
            showModal(contentModal);
        }

        // 选择难度
        function selectDifficulty(level) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = '#374151';
                btn.style.borderColor = '#e5e7eb';
            });
            
            const selectedBtn = document.querySelector(`[data-level="${level}"]`);
            selectedBtn.style.background = '#10B981';
            selectedBtn.style.color = 'white';
            selectedBtn.style.borderColor = '#10B981';
        }

        // 保存内容设置
        function saveContentSettings() {
            const settings = {
                difficulty: document.querySelector('.difficulty-btn[style*="rgb(16, 185, 129)"]')?.getAttribute('data-level') || 'easy',
                contentTypes: Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.parentElement.textContent.trim()),
                timestamp: Date.now()
            };
            
            localStorage.setItem('contentSettings', JSON.stringify(settings));
            closeModal();
            showNotification('内容管理设置已保存', 'success');
            
            logParentAction('manage_content', `更新内容设置: 难度${settings.difficulty}`);
        }

        // 设置奖励机制
        function setRewards() {
            const rewardModal = `
                <div style="background: white; border-radius: 16px; padding: 24px; max-width: 450px; margin: 20px;">
                    <h3 style="margin-bottom: 20px; color: #374151; font-size: 18px; font-weight: 600;">
                        <i class="fas fa-gift text-yellow-500 mr-2"></i>奖励机制设置
                    </h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px; color: #374151; font-size: 14px; font-weight: 600;">完成任务奖励</h4>
                        <div style="background: #f8fafc; border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px;">单个任务完成</span>
                                <input type="number" value="10" min="1" max="50" style="width: 60px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 4px; text-align: center;">
                                <span style="font-size: 12px; color: #6b7280;">积分</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px;">每日目标达成</span>
                                <input type="number" value="50" min="10" max="200" style="width: 60px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 4px; text-align: center;">
                                <span style="font-size: 12px; color: #6b7280;">积分</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 13px;">连续学习奖励</span>
                                <input type="number" value="100" min="20" max="500" style="width: 60px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 4px; text-align: center;">
                                <span style="font-size: 12px; color: #6b7280;">积分</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px; color: #374151; font-size: 14px; font-weight: 600;">特殊奖励</h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 解锁新角色形象
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox" checked> 获得虚拟勋章
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox"> 额外学习时间
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                <input type="checkbox"> 定制学习内容
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 12px; color: #374151; font-size: 14px; font-weight: 600;">实体奖励</h4>
                        <textarea placeholder="例如：每周完成目标可以额外看30分钟动画片..."
                                  style="width: 100%; height: 60px; padding: 8px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 13px; resize: none;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeModal()" 
                                style="flex: 1; padding: 12px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            取消
                        </button>
                        <button onclick="saveRewardSettings()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(135deg, #F59E0B, #D97706); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            保存奖励
                        </button>
                    </div>
                </div>
            `;
            
            showModal(rewardModal);
        }

        // 保存奖励设置
        function saveRewardSettings() {
            const rewardInputs = document.querySelectorAll('input[type="number"]');
            const rewards = {
                taskCompletion: parseInt(rewardInputs[0]?.value) || 10,
                dailyGoal: parseInt(rewardInputs[1]?.value) || 50,
                consecutive: parseInt(rewardInputs[2]?.value) || 100,
                specialRewards: Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).length,
                customReward: document.querySelector('textarea')?.value || '',
                timestamp: Date.now()
            };
            
            localStorage.setItem('rewardSettings', JSON.stringify(rewards));
            closeModal();
            showNotification('奖励机制已设置完成', 'success');
            
            logParentAction('set_rewards', `设置奖励机制: 任务${rewards.taskCompletion}分/目标${rewards.dailyGoal}分`);
        }

        // 亲子学习功能
        function joinLearning() {
            const joinModal = `
                <div style="background: white; border-radius: 16px; padding: 24px; max-width: 400px; margin: 20px;">
                    <h3 style="margin-bottom: 20px; color: #374151; font-size: 18px; font-weight: 600;">
                        <i class="fas fa-users text-green-500 mr-2"></i>亲子学习模式
                    </h3>
                    
                    <div style="margin-bottom: 20px;">
                        <p style="font-size: 14px; color: #6b7280; line-height: 1.5; margin-bottom: 16px;">
                            选择一种方式参与孩子的学习过程，增进亲子关系的同时提升学习效果。
                        </p>
                        
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <button onclick="startCooperativeLearning()" 
                                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-handshake" style="font-size: 20px;"></i>
                                <div>
                                    <div style="font-size: 14px; font-weight: 600;">协作学习</div>
                                    <div style="font-size: 12px; opacity: 0.9;">与孩子一起完成学习任务</div>
                                </div>
                            </button>
                            
                            <button onclick="startGuidedLearning()" 
                                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #3B82F6, #1E40AF); color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-compass" style="font-size: 20px;"></i>
                                <div>
                                    <div style="font-size: 14px; font-weight: 600;">指导学习</div>
                                    <div style="font-size: 12px; opacity: 0.9;">在旁边指导孩子学习</div>
                                </div>
                            </button>
                            
                            <button onclick="startObserveLearning()" 
                                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-eye" style="font-size: 20px;"></i>
                                <div>
                                    <div style="font-size: 14px; font-weight: 600;">观察学习</div>
                                    <div style="font-size: 12px; opacity: 0.9;">默默观察孩子的学习过程</div>
                                </div>
                            </button>
                            
                            <button onclick="scheduleFamily()" 
                                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #F59E0B, #D97706); color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-calendar-plus" style="font-size: 20px;"></i>
                                <div>
                                    <div style="font-size: 14px; font-weight: 600;">安排家庭学习时间</div>
                                    <div style="font-size: 12px; opacity: 0.9;">设定固定的亲子学习时段</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="closeModal()" 
                            style="width: 100%; padding: 12px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        暂时不参与
                    </button>
                </div>
            `;
            
            showModal(joinModal);
        }

        // 开始协作学习
        function startCooperativeLearning() {
            closeModal();
            showNotification('正在启动协作学习模式...', 'info');
            
            setTimeout(() => {
                showNotification('协作学习模式已启动！您和孩子可以一起完成接下来的任务。', 'success');
                
                // 通知孩子的设备
                setTimeout(() => {
                    showNotification('已通知孩子的设备：爸爸/妈妈将参与学习！', 'info');
                }, 2000);
            }, 1500);
            
            logParentAction('join_learning', '开始协作学习模式');
        }

        // 开始指导学习
        function startGuidedLearning() {
            closeModal();
            showNotification('正在启动指导学习模式...', 'info');
            
            setTimeout(() => {
                const guidance = `
🎓 指导学习模式已启动

📋 指导建议：
• 鼓励孩子独立思考
• 适时提供提示和帮助
• 关注孩子的学习状态
• 及时给予正面反馈

💡 指导技巧：
• 用问题引导思考
• 分享你的学习经验
• 耐心等待孩子回答
• 创造轻松的学习氛围

当前任务：创意表达练习
建议指导时间：15-20分钟
                `;
                
                showNotification(guidance, 'success');
            }, 1500);
            
            logParentAction('join_learning', '开始指导学习模式');
        }

        // 观察学习
        function startObserveLearning() {
            closeModal();
            showNotification('正在启动观察学习模式...', 'info');
            
            setTimeout(() => {
                showNotification('观察模式已启动。您可以看到孩子的学习进度，但不会干扰学习过程。', 'success');
                
                // 启动实时监控
                setTimeout(() => {
                    toggleRealTimeMonitor();
                }, 1000);
            }, 1500);
            
            logParentAction('join_learning', '开始观察学习模式');
        }

        // 安排家庭学习时间
        function scheduleFamily() {
            closeModal();
            
            const scheduleTime = prompt('请设置家庭学习时间（格式：HH:MM）：', '19:30');
            if (scheduleTime && /^\d{2}:\d{2}$/.test(scheduleTime)) {
                const familySchedule = {
                    time: scheduleTime,
                    enabled: true,
                    days: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                    createdAt: Date.now()
                };
                
                localStorage.setItem('familyLearningSchedule', JSON.stringify(familySchedule));
                showNotification(`家庭学习时间已设定为每天${scheduleTime}`, 'success');
                
                logParentAction('schedule_family', `设定家庭学习时间: ${scheduleTime}`);
            } else if (scheduleTime) {
                showNotification('时间格式不正确，请使用HH:MM格式', 'error');
            }
        }

        // 通用模态框显示函数
        function showModal(content) {
            // 创建模态框容器
            const modal = document.createElement('div');
            modal.id = 'parentModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
            
            // 动画显示
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 50);
            
            // 点击背景关闭
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        // 关闭模态框
        function closeModal() {
            const modal = document.getElementById('parentModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }

        // 关闭目标模态框
        function closeGoalModal() {
            closeModal();
        }

        // 更新学习状态
        function updateLearningStatus(status) {
            const statusElements = document.querySelectorAll('.learning-status');
            statusElements.forEach(element => {
                switch(status) {
                    case 'paused':
                        element.textContent = '学习已暂停';
                        element.style.color = '#EF4444';
                        break;
                    case 'active':
                        element.textContent = '正在学习';
                        element.style.color = '#10B981';
                        break;
                    case 'idle':
                        element.textContent = '等待开始';
                        element.style.color = '#6B7280';
                        break;
                }
            });
        }

        // 更新目标显示
        function updateGoalDisplay(goals) {
            // 在界面上显示设置的目标
            const goalDisplay = document.querySelector('.goal-display');
            if (goalDisplay) {
                goalDisplay.innerHTML = `
                    <div style="font-size: 12px; color: #6b7280;">
                        每日目标：${goals.dailyTime}分钟 | ${goals.dailyTasks}个任务
                    </div>
                `;
            }
        }

        // 记录家长操作
        function logParentAction(action, description) {
            const log = {
                action: action,
                description: description,
                timestamp: Date.now(),
                date: new Date().toLocaleString()
            };
            
            // 获取现有日志
            const existingLogs = JSON.parse(localStorage.getItem('parentActionLogs') || '[]');
            existingLogs.push(log);
            
            // 只保留最近100条记录
            if (existingLogs.length > 100) {
                existingLogs.splice(0, existingLogs.length - 100);
            }
            
            localStorage.setItem('parentActionLogs', JSON.stringify(existingLogs));
        }

        // 为所有蓝色控制按钮添加点击效果
        document.addEventListener('DOMContentLoaded', function() {
            const controlCards = document.querySelectorAll('.control-card');
            controlCards.forEach(card => {
                card.addEventListener('click', function() {
                    // 添加点击动画效果
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                    
                    // 震动反馈
                    vibrateDevice([50]);
                });
            });
        });

        // 开始实时更新
        function startRealTimeUpdates() {
            if (!realTimeUpdates) return;
            
            setInterval(() => {
                updateRealTimeData();
            }, 30000); // 每30秒更新一次
        }

        // 更新实时数据
        function updateRealTimeData() {
            // 模拟实时数据更新
            const timeElement = document.querySelector('.child-status span:last-child');
            if (timeElement) {
                const currentTime = new Date().toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                timeElement.textContent = `今日已学习 ${Math.floor(Math.random() * 20) + 30}分钟`;
            }
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 监听页面可见性变化
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    updateRealTimeData();
                }
            });

            // 监听网络状态变化
            window.addEventListener('online', function() {
                showNotification('网络连接已恢复', 'success');
                startRealTimeUpdates();
            });

            window.addEventListener('offline', function() {
                showNotification('网络连接断开，部分功能可能受限', 'warning');
                realTimeUpdates = false;
            });
        }

        // 保存设置
        function saveSettings() {
            const settings = {};
            document.querySelectorAll('.toggle-switch').forEach((toggle, index) => {
                settings[`setting_${index}`] = toggle.classList.contains('active');
            });
            
            localStorage.setItem('parentPanelSettings', JSON.stringify(settings));
        }

        // 加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('parentPanelSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    document.querySelectorAll('.toggle-switch').forEach((toggle, index) => {
                        if (settings[`setting_${index}`]) {
                            toggle.classList.add('active');
                        } else {
                            toggle.classList.remove('active');
                        }
                    });
                } catch (e) {
                    console.error('设置加载失败:', e);
                }
            }
        }

        // 创建波纹效果
        function createRippleEffect(element, event) {
            const ripple = document.createElement('span');
            ripple.className = 'ripple-effect';
            
            const rect = element.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            
            element.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        }

        // 震动反馈
        function vibrateDevice(pattern = [50]) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            parent.postMessage({
                type: 'showNotification',
                message: message,
                notificationType: type
            }, '*');
        }

        // 显示通知
        function showNotifications() {
            const notifications = `
🔔 通知中心

📊 今日学习报告已生成
⏰ 提醒：距离学习目标还差15分钟
🏆 恭喜！孩子获得了新勋章"创意大师"
📱 系统更新：新增亲子学习模式

全部标记为已读
            `;
            
            showNotification(notifications, 'info');
        }

        // 显示帮助
        function showHelp() {
            const helpContent = `
📖 家长控制面板帮助

🎯 主要功能：
• 概览：查看孩子学习概况和最新动态
• 进度：详细了解学习进度和趋势
• 控制：管理学习时间和内容设置
• 设置：个性化配置和安全选项

💡 使用技巧：
• 定期查看学习报告了解进展
• 合理设置学习时间避免过度使用
• 开启通知及时了解孩子动态
• 利用亲子模式增进亲子关系

🔧 常见问题：
• 如何暂停学习？在控制页面点击暂停按钮
• 如何查看详细报告？点击生成报告按钮
• 如何联系客服？点击紧急控制中的联系选项

需要更多帮助请联系客服支持。
            `;
            
            showNotification(helpContent, 'info');
        }

        // 导航到页面
        function navigateToPage(page) {
            parent.postMessage({
                type: 'navigate',
                page: page
            }, '*');
        }

        // 导航到账号中心
        function navigateToAccountCenter() {
            showNotification('正在打开账号中心...', 'info');
            setTimeout(() => {
                // 在原型内部跳转，不打开新标签页
                window.location.href = 'account-center.html';
            }, 500);
        }

        // 返回上一页
        function navigateBack() {
            parent.postMessage({
                type: 'navigate',
                page: 'home'
            }, '*');
        }

        // 页面卸载时保存数据
        window.addEventListener('beforeunload', function() {
            saveSettings();
        });

        // 为所有可点击元素添加反馈效果
        document.addEventListener('click', function(e) {
            if (e.target.matches('button, .control-card, .overview-card, .fab-button')) {
                createRippleEffect(e.target, e);
                vibrateDevice([30]);
            }
        });

        // 在现有JavaScript中添加图表动画函数
        function animateChart() {
            setTimeout(() => {
                const chartBars = document.querySelectorAll('.chart-bar');
                chartBars.forEach((bar, index) => {
                    // 重置高度
                    bar.style.height = '0%';
                    
                    setTimeout(() => {
                        // 获取目标高度
                        const targetHeight = bar.getAttribute('data-value');
                        const heightPercentage = Math.min((targetHeight / 100) * 100, 95); // 最大95%防止溢出
                        
                        // 动画到目标高度
                        bar.style.height = heightPercentage + '%';
                        
                        // 添加数值显示动画
                        setTimeout(() => {
                            bar.style.position = 'relative';
                        }, 800);
                    }, index * 150);
                });
            }, 1000);
        }

        // 添加图表交互功能
        function setupChartInteractions() {
            const chartBars = document.querySelectorAll('.chart-bar');
            chartBars.forEach((bar, index) => {
                bar.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const dayNames = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                    const dayName = dayNames[index];
                    
                    showNotification(`${dayName}学习表现：${value}分\n\n${getPerformanceComment(parseInt(value))}`, 'info');
                    
                    // 添加点击动画
                    this.style.transform = 'scaleY(1.1) scaleX(1.2)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
        }

        // 获取表现评价
        function getPerformanceComment(score) {
            if (score >= 90) {
                return '表现优秀！继续保持！🌟';
            } else if (score >= 80) {
                return '表现良好，还有提升空间！👍';
            } else if (score >= 70) {
                return '表现一般，需要加油哦！💪';
            } else {
                return '需要更多练习和努力！📚';
            }
        }

        // 完善浮动按钮交互功能
        function setupFloatingButtonInteractions() {
            const floatingButtons = document.querySelectorAll('.floating-button');
            
            floatingButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    
                    switch(action) {
                        case 'emergency':
                            showEmergencyControls();
                            break;
                        case 'report':
                            generateQuickReport();
                            break;
                        case 'settings':
                            showSettings();
                            break;
                        case 'help':
                            showHelp();
                            break;
                    }
                    
                    // 添加点击反馈
                    this.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
        }

        // 显示设置面板
        function showSettings() {
            showNotification('设置面板功能开发中...', 'info');
        }

        // 显示帮助信息
        function showHelp() {
            showNotification('帮助信息功能开发中...', 'info');
        }

    // 显示紧急控制面板
    function showEmergencyControls() {
        const panel = document.getElementById('emergencyPanel');
        if (panel) {
            panel.classList.add('show');
            vibrateDevice([100, 50, 100]);
            showNotification('紧急控制面板已打开', 'warning');
        }
    }

    // 关闭紧急控制面板
    function closeEmergencyPanel() {
        const panel = document.getElementById('emergencyPanel');
        if (panel) {
            panel.classList.remove('show');
        }
    }

    // 生成快速报告 - 优化版本
    function generateQuickReport() {
        const reportButton = document.querySelector('.fab-button.report');
        const originalContent = reportButton.innerHTML;
        
        // 添加加载动画
        reportButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        reportButton.style.pointerEvents = 'none';
        
        // 添加点击反馈
        reportButton.style.transform = 'scale(0.9)';
        setTimeout(() => {
            reportButton.style.transform = 'scale(1.05)';
        }, 100);
        setTimeout(() => {
            reportButton.style.transform = 'scale(1)';
        }, 200);
        
        showNotification('⚡ 正在智能生成学习报告...', 'info');
        
                 setTimeout(() => {
             // 恢复按钮状态
             reportButton.innerHTML = originalContent;
             reportButton.style.pointerEvents = 'auto';
             
             // 生成并显示报告
             generateDetailedReport();
             
             // 隐藏报告徽章
             hideReportBadge();
             
             // 跳转到家长专用报告页面
             setTimeout(() => {
                 navigateToParentReport();
             }, 1500);
             
         }, 2000);
    }

    // 生成详细报告数据
    function generateDetailedReport() {
        const now = new Date();
        const reportData = {
            id: 'report_' + Date.now(),
            date: now.toISOString(),
            title: `学习报告 - ${now.toLocaleDateString()}`,
            summary: '今日学习表现优秀，各项指标均有提升',
            studyTime: '2小时15分钟',
            completedTasks: 3,
            totalTasks: 5,
            experience: 150,
            accuracy: 87,
            abilities: {
                expression: { score: 88, change: '+5', level: '良好' },
                reading: { score: 82, change: '+3', level: '优秀' },
                creativity: { score: 92, change: '+8', level: '优秀' },
                communication: { score: 75, change: '+2', level: '一般' }
            },
            highlights: [
                '创意表达任务获得满分',
                '连续学习天数达到8天',
                '主动与AI助手交流练习'
            ],
            concerns: [
                '沟通交流能力需要加强',
                '建议增加互动练习时间'
            ],
            recommendations: [
                '重点练习日常对话',
                '完成2-3个表达任务',
                '保持学习连续性'
            ],
            deviceInfo: {
                usageTime: '2小时30分钟',
                breaks: 4,
                eyeProtection: '良好'
            },
            safety: {
                contentFilter: '已启用',
                timeLimit: '正常',
                location: '家庭环境'
            },
            type: 'detailed_report'
        };
        
        // 保存到本地存储
        const reports = JSON.parse(localStorage.getItem('parentReports') || '[]');
        reports.unshift(reportData);
        localStorage.setItem('parentReports', JSON.stringify(reports.slice(0, 10)));
        localStorage.setItem('currentReport', JSON.stringify(reportData));
        
        showNotification('✅ 学习报告生成完成！正在跳转到详情页面...', 'success');
        
        return reportData;
    }

         // 跳转到家长报告页面
     function navigateToParentReport() {
         // 添加页面切换动画
         document.body.style.opacity = '0';
         document.body.style.transform = 'scale(0.95)';
         
         setTimeout(() => {
             parent.postMessage({
                 type: 'openPage',
                 url: 'parent-ai.html'
             }, '*');
         }, 300);
     }

     // 检查是否有新的学习数据可以生成报告
     function checkForNewReportData() {
         const lastReportTime = localStorage.getItem('lastReportTime');
         const now = Date.now();
         const oneHour = 60 * 60 * 1000; // 1小时
         
         if (!lastReportTime || (now - parseInt(lastReportTime)) > oneHour) {
             // 显示报告徽章
             const reportBadge = document.getElementById('reportBadge');
             if (reportBadge) {
                 reportBadge.classList.remove('hidden');
             }
         }
     }

     // 隐藏报告徽章
     function hideReportBadge() {
         const reportBadge = document.getElementById('reportBadge');
         if (reportBadge) {
             reportBadge.classList.add('hidden');
         }
         localStorage.setItem('lastReportTime', Date.now().toString());
     }

    // 切换实时监控 - 修复小眼睛按钮功能
    function toggleRealTimeMonitor() {
        const button = document.querySelector('[onclick="toggleRealTimeMonitor()"]');
        const monitorPanel = document.getElementById('monitorPanel');
        
        if (!monitoringActive) {
            // 开启监控
            monitoringActive = true;
            button.style.background = 'linear-gradient(135deg, #059669, #10B981)';
            button.innerHTML = '<i class="fas fa-eye-slash"></i>';
            showNotification('实时监控已开启', 'success');
            
            // 显示监控面板
            monitorPanel.classList.add('show');
            
            // 开始监控数据更新
            startMonitoring();
            
        } else {
            // 关闭监控
            monitoringActive = false;
            button.style.background = 'linear-gradient(135deg, #10B981, #059669)';
            button.innerHTML = '<i class="fas fa-eye"></i>';
            showNotification('实时监控已关闭', 'info');
            
            // 隐藏监控面板
            monitorPanel.classList.remove('show');
            
            // 停止监控
            stopMonitoring();
        }
    }

    // 关闭监控面板
    function closeMonitorPanel() {
        const monitorPanel = document.getElementById('monitorPanel');
        monitorPanel.classList.remove('show');
        
        // 重置按钮状态
        const button = document.querySelector('[onclick="toggleRealTimeMonitor()"]');
        monitoringActive = false;
        button.style.background = 'linear-gradient(135deg, #10B981, #059669)';
        button.innerHTML = '<i class="fas fa-eye"></i>';
        
        stopMonitoring();
        showNotification('监控面板已关闭', 'info');
    }

    // 开始监控
    function startMonitoring() {
        updateMonitoringData();
        monitoringInterval = setInterval(updateMonitoringData, 1000);
        
        // 检查异常情况
        setTimeout(checkForAlerts, 5000);
    }

    // 停止监控
    function stopMonitoring() {
        if (monitoringInterval) {
            clearInterval(monitoringInterval);
            monitoringInterval = null;
        }
    }

    // 更新监控数据
    function updateMonitoringData() {
        const currentTime = Date.now();
        const sessionDuration = Math.floor((currentTime - sessionStartTime) / 1000);
        const minutes = Math.floor(sessionDuration / 60);
        const seconds = sessionDuration % 60;
        
        // 更新会话时长
        document.getElementById('currentSessionTime').textContent = 
            `${minutes}分${seconds.toString().padStart(2, '0')}秒`;
        
        // 更新已完成任务
        document.getElementById('tasksCompleted').textContent = `${currentTasks}/${totalTasks}`;
        
        // 模拟电量变化
        const battery = Math.max(50, 100 - Math.floor(sessionDuration / 60) * 2);
        document.getElementById('deviceBattery').textContent = `${battery}%`;
        
        // 更新电池图标
        const batteryIcon = document.querySelector('#deviceBattery').parentElement.parentElement.querySelector('i');
        if (battery > 75) {
            batteryIcon.className = 'fas fa-battery-full';
        } else if (battery > 50) {
            batteryIcon.className = 'fas fa-battery-three-quarters';
        } else if (battery > 25) {
            batteryIcon.className = 'fas fa-battery-half';
        } else {
            batteryIcon.className = 'fas fa-battery-quarter';
        }
    }

    // 检查警告
    function checkForAlerts() {
        const alertsContainer = document.querySelector('.monitor-alerts');
        
        // 清空现有警告
        alertsContainer.innerHTML = '';
        
        // 检查电量
        const battery = parseInt(document.getElementById('deviceBattery').textContent);
        if (battery < 30) {
            addAlert('warning', '⚠️', '设备电量较低，建议充电');
        }
        
        // 检查学习时长
        const sessionTime = document.getElementById('currentSessionTime').textContent;
        const minutes = parseInt(sessionTime.split('分')[0]);
        if (minutes > 45) {
            addAlert('warning', '⏰', '学习时间较长，建议适当休息');
        }
        
        // 检查任务完成情况
        if (currentTasks >= totalTasks) {
            addAlert('success', '🎉', '今日任务全部完成，表现出色！');
        }
        
        if (alertsContainer.children.length === 0) {
            alertsContainer.innerHTML = '<div style="text-align: center; color: #6B7280; font-size: 12px;">暂无异常情况</div>';
        }
    }

    // 添加警告
    function addAlert(type, icon, message) {
        const alertsContainer = document.querySelector('.monitor-alerts');
        const alertItem = document.createElement('div');
        alertItem.className = `alert-item ${type}`;
        alertItem.innerHTML = `
            <span>${icon}</span>
            <span>${message}</span>
        `;
        alertsContainer.appendChild(alertItem);
    }

    // 显示快速设置
    function showQuickSettings() {
        const panel = document.getElementById('quickSettingsPanel');
        if (panel) {
            panel.classList.add('show');
            showNotification('快速设置面板已打开', 'info');
        }
    }

    // 关闭快速设置
    function closeQuickSettings() {
        const panel = document.getElementById('quickSettingsPanel');
        if (panel) {
            panel.classList.remove('show');
        }
    }

    // 添加活动到时间线
    function addActivityToTimeline(action, score) {
        const timeline = document.getElementById('activityTimeline');
        if (timeline) {
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const newItem = document.createElement('div');
            newItem.className = 'timeline-item';
            newItem.innerHTML = `
                <div class="timeline-time">${timeString}</div>
                <div class="timeline-content">
                    <div class="timeline-action">${action}</div>
                    <div class="timeline-score">${score}</div>
                </div>
            `;
            
            timeline.insertBefore(newItem, timeline.firstChild);
            
            // 限制显示最近10条记录
            const items = timeline.querySelectorAll('.timeline-item');
            if (items.length > 10) {
                timeline.removeChild(items[items.length - 1]);
            }
        }
    }

    // 页面加载时的事件监听
    document.addEventListener('DOMContentLoaded', function() {
        // 为所有关闭按钮添加事件监听器
        document.addEventListener('click', function(e) {
            // 点击面板背景关闭
            if (e.target.id === 'emergencyPanel') {
                closeEmergencyPanel();
            }
            if (e.target.id === 'quickSettingsPanel') {
                closeQuickSettings();
            }
            if (e.target.id === 'monitorPanel') {
                closeMonitorPanel();
            }
            
            // 点击关闭按钮
            if (e.target.closest('.emergency-close')) {
                closeEmergencyPanel();
            }
            if (e.target.closest('.settings-close')) {
                closeQuickSettings();
            }
            if (e.target.closest('.monitor-close')) {
                closeMonitorPanel();
            }
        });
    });

    // 键盘快捷键
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeEmergencyPanel();
            closeQuickSettings();
            closeMonitorPanel();
        }
    });

    // 添加浮动按钮悬停效果
    document.querySelectorAll('.fab-button').forEach(button => {
        button.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1)';
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });

    // 自动保存监控数据
    setInterval(() => {
        if (monitoringActive) {
            const monitoringData = {
                timestamp: Date.now(),
                sessionTime: document.getElementById('currentSessionTime')?.textContent || '0分0秒',
                tasksCompleted: document.getElementById('tasksCompleted')?.textContent || '0/0',
                deviceBattery: document.getElementById('deviceBattery')?.textContent || '100%'
            };
            
            localStorage.setItem('lastMonitoringData', JSON.stringify(monitoringData));
        }
    }, 10000); // 每10秒保存一次

    // 确保关闭按钮正常工作
    document.addEventListener('DOMContentLoaded', function() {
        // 为所有关闭按钮添加事件监听器
        document.querySelectorAll('.emergency-close').forEach(btn => {
            btn.addEventListener('click', closeEmergencyPanel);
        });
        
        document.querySelectorAll('.settings-close').forEach(btn => {
            btn.addEventListener('click', closeQuickSettings);
        });
        
        document.querySelectorAll('.monitor-close').forEach(btn => {
            btn.addEventListener('click', closeMonitorPanel);
        });
    });

    // 实时监控相关变量
    let monitoringActive = false;
    let monitoringInterval = null;
    let sessionStartTime = Date.now();
    let currentTasks = 3;
    let totalTasks = 5;

    // 添加到现有的script标签中
    function openNotificationCenter() {
        const modal = document.getElementById('notificationCenterModal');
        modal.classList.add('show');
        
        // 添加背景点击关闭
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeNotificationCenter();
            }
        });
        
        // 更新未读通知统计
        updateNotificationStats();
    }

    function closeNotificationCenter() {
        const modal = document.getElementById('notificationCenterModal');
        modal.classList.remove('show');
    }

    function filterNotifications(type) {
        // 更新筛选按钮状态
        document.querySelectorAll('.notification-filter').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // 筛选通知项
        const notifications = document.querySelectorAll('.notification-item');
        notifications.forEach(item => {
            const itemType = item.getAttribute('data-type');
            if (type === 'all' || itemType === type) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
        
        // 震动反馈
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }

    function markAsRead(item) {
        item.classList.remove('unread');
        updateNotificationStats();
        updateNotificationBadge();
        
        // 震动反馈
        if (navigator.vibrate) {
            navigator.vibrate(50);
        }
    }

    function markAllAsRead() {
        const unreadItems = document.querySelectorAll('.notification-item.unread');
        unreadItems.forEach(item => {
            item.classList.remove('unread');
        });
        
        updateNotificationStats();
        updateNotificationBadge();
        
        // 显示成功提示
        showToast('已将所有通知标记为已读', 'success');
        
        // 震动反馈
        if (navigator.vibrate) {
            navigator.vibrate([50, 50, 50]);
        }
    }

    function updateNotificationStats() {
        const unreadCount = document.querySelectorAll('.notification-item.unread').length;
        const totalToday = document.querySelectorAll('.notification-item').length;
        
        // 更新统计信息
        const statsContainer = document.querySelector('.notification-stats');
        if (statsContainer) {
            statsContainer.innerHTML = `
                <div class="notification-stat">
                    <div class="stat-dot ${unreadCount > 0 ? 'unread' : ''}"></div>
                    <span>${unreadCount}条未读</span>
                </div>
                <div class="notification-stat">
                    <div class="stat-dot"></div>
                    <span>今日${totalToday}条</span>
                </div>
            `;
        }
    }

    function updateNotificationBadge() {
        const unreadCount = document.querySelectorAll('.notification-item.unread').length;
        const badges = document.querySelectorAll('.notification-badge');
        
        badges.forEach(badge => {
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        });
    }

    function openNotificationSettings() {
        closeNotificationCenter();
        window.location.href = 'settings.html#notifications';
    }

    function showToast(message, type = 'info') {
        // 这里可以调用现有的通知系统
        parent.postMessage({
            type: 'showNotification',
            message: message,
            notificationType: type
        }, '*');
    }

    // 键盘快捷键支持
    document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('notificationCenterModal');
        
        if (e.key === 'Escape' && modal.classList.contains('show')) {
            closeNotificationCenter();
        }
        
        // Ctrl/Cmd + Shift + N 打开通知中心
        if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'N') {
            e.preventDefault();
            openNotificationCenter();
        }
    });

    // 初始化时更新通知徽章
    document.addEventListener('DOMContentLoaded', function() {
        updateNotificationBadge();
        updateNotificationStats();
        
        // 检查是否有新的学习数据可以生成报告
        checkForNewReportData();
        
        // 每5分钟检查一次是否有新数据
        setInterval(checkForNewReportData, 5 * 60 * 1000);
    });

    // 实时通知推送模拟
    function simulateNewNotification() {
        const notifications = [
            {
                type: 'child-activity',
                icon: 'fas fa-graduation-cap',
                title: '孩子开始新的学习任务',
                desc: '小明正在进行创意思维训练，预计需要15分钟',
                time: '刚刚'
            },
            {
                type: 'achievement',
                icon: 'fas fa-star',
                title: '学习里程碑',
                desc: '孩子已连续学习7天，获得坚持学习成就！',
                time: '刚刚'
            }
        ];
        
        const randomNotification = notifications[Math.floor(Math.random() * notifications.length)];
        addNewNotification(randomNotification);
    }

    function addNewNotification(notificationData) {
        const listContainer = document.querySelector('.notification-list-container');
        const newItem = document.createElement('div');
        newItem.className = 'notification-item unread';
        newItem.setAttribute('data-type', notificationData.type);
        newItem.onclick = () => markAsRead(newItem);
        
        newItem.innerHTML = `
            <div class="notification-icon ${notificationData.type}">
                <i class="${notificationData.icon}"></i>
            </div>
            <div class="notification-content">
                <div class="notification-title">${notificationData.title}</div>
                <div class="notification-desc">${notificationData.desc}</div>
                <div class="notification-time">
                    <i class="fas fa-clock time-icon"></i>
                    <span>${notificationData.time}</span>
                </div>
            </div>
        `;
        
        // 添加到列表顶部
        listContainer.insertBefore(newItem, listContainer.firstChild);
        
        // 更新统计和徽章
        updateNotificationStats();
        updateNotificationBadge();
        
        // 如果通知中心是打开的，显示新通知动画
        const modal = document.getElementById('notificationCenterModal');
        if (modal.classList.contains('show')) {
            newItem.style.transform = 'translateX(-100%)';
            setTimeout(() => {
                newItem.style.transition = 'transform 0.3s ease';
                newItem.style.transform = 'translateX(0)';
            }, 100);
        }
        
        // 震动反馈
        if (navigator.vibrate) {
            navigator.vibrate([100, 50, 100]);
        }
    }

    // 每30秒模拟一个新通知（测试用）
    // setInterval(simulateNewNotification, 30000);
    </script>
</body>
</html>