<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡è¯¦æƒ… - èŒèŠ½AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="mengya-common.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .task-container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.15);
            overflow: hidden;
            margin: 12px;
        }
        
        .task-header {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            color: white;
            padding: 32px 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .task-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: headerGlow 6s ease-in-out infinite;
        }
        
        @keyframes headerGlow {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }
        
        .task-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: iconFloat 3s ease-in-out infinite;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-8px) scale(1.05); }
        }
        
        .task-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .task-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .difficulty-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .content-section {
            padding: 24px;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 20px;
        }
        
        .section-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        .task-description {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            line-height: 1.7;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .task-description::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8B5CF6, #EC4899);
        }
        
        .task-requirements {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
            position: relative;
        }
        
        .requirements-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .requirements-title {
            font-weight: 700;
            color: #92400e;
            font-size: 16px;
        }
        
        .requirements-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .requirements-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #92400e;
        }
        
        .requirement-check {
            width: 20px;
            height: 20px;
            background: #f59e0b;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            flex-shrink: 0;
            animation: checkPulse 2s infinite;
        }
        
        @keyframes checkPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .hint-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .hint-card::before {
            content: 'ğŸ’¡';
            position: absolute;
            top: 16px;
            right: 20px;
            font-size: 24px;
            animation: bulbGlow 2s ease-in-out infinite;
        }
        
        @keyframes bulbGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .hint-title {
            font-weight: 700;
            color: #166534;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .hint-content {
            color: #166534;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .ai-interaction-area {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .ai-assistant {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .ai-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: avatarPulse 3s ease-in-out infinite;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        
        @keyframes avatarPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        
        .ai-message {
            flex: 1;
            background: white;
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.15);
            font-size: 15px;
            line-height: 1.6;
            position: relative;
        }
        
        .ai-message::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 20px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid white;
        }
        
        .ai-help-btn {
            width: 100%;
            background: white;
            border: 2px solid #0ea5e9;
            color: #0ea5e9;
            padding: 16px 20px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .ai-help-btn:hover {
            background: #0ea5e9;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.3);
        }
        
        .input-area {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            padding: 20px;
            transition: all 0.3s ease;
            margin-bottom: 24px;
        }
        
        .input-area:focus-within {
            border-color: #8B5CF6;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }
        
        .text-input {
            width: 100%;
            min-height: 140px;
            border: none;
            outline: none;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
            font-family: inherit;
        }
        
        .text-input::placeholder {
            color: #9ca3af;
        }
        
        .input-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
        
        .tool-group {
            display: flex;
            gap: 8px;
        }
        
        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            background: white;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tool-btn:hover {
            background: #f3f4f6;
            border-color: #8B5CF6;
            color: #8B5CF6;
            transform: translateY(-1px);
        }
        
        .word-count {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .timer-display {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 700;
            color: #92400e;
            font-size: 16px;
        }
        
        .timer-icon {
            animation: timerTick 1s infinite;
            font-size: 18px;
        }
        
        @keyframes timerTick {
            0%, 50% { transform: scale(1); }
            25% { transform: scale(1.15); }
        }
        
        .submit-area {
            padding: 24px;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border-top: 1px solid #e5e7eb;
        }
        
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .submit-hint {
            text-align: center;
            margin-top: 12px;
            font-size: 13px;
            color: #6b7280;
        }
        
        .floating-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #10B981, #059669);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
            animation: helpFloat 4s ease-in-out infinite;
        }
        
        @keyframes helpFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.5);
        }
        
        .example-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .example-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .example-content {
            font-size: 14px;
            color: #6b7280;
            font-style: italic;
            line-height: 1.6;
        }
        
        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .task-container {
                margin: 8px;
                border-radius: 20px;
            }
            
            .content-section {
                padding: 20px;
            }
            
            .task-icon {
                font-size: 56px;
            }
            
            .task-title {
                font-size: 24px;
            }
            
            .ai-assistant {
                gap: 12px;
            }
            
            .ai-avatar {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="gradient-bg px-6 py-6 text-white">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all" onclick="navigateBack()">
                    <i class="fas fa-arrow-left text-sm"></i>
                </button>
                <h1 class="text-xl font-bold">ä»Šæ—¥ä»»åŠ¡</h1>
            </div>
            <div class="text-sm opacity-90">
                <i class="fas fa-clock mr-1"></i>
                <span id="taskTimer">25:00</span>
            </div>
        </div>
        
        <!-- ä»»åŠ¡è¿›åº¦ -->
        <div class="bg-white bg-opacity-15 rounded-xl p-4 mt-4 backdrop-blur-sm border border-white border-opacity-20">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium">ä»»åŠ¡è¿›åº¦</span>
                <span class="text-sm">30%</span>
            </div>
            <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                <div class="bg-white h-2 rounded-full transition-all duration-1000" style="width: 30%"></div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="pb-20">
        <div class="task-container">
            <!-- ä»»åŠ¡å¤´éƒ¨ -->
            <div class="task-header">
                <div class="task-icon">ğŸ¨</div>
                <h2 class="task-title">åˆ›æ„è¡¨è¾¾æŒ‘æˆ˜</h2>
                <p class="task-subtitle">ç”¨ä½ çš„æƒ³è±¡åŠ›æè¿°ä¸€ä¸ªç¥å¥‡çš„ä¸–ç•Œ</p>
                <div class="difficulty-badge">
                    <i class="fas fa-star"></i>
                    <span>ä¸­ç­‰éš¾åº¦</span>
                </div>
            </div>

            <!-- ä»»åŠ¡æè¿° -->
            <div class="content-section">
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-info"></i></div>
                    <span>ä»»åŠ¡æè¿°</span>
                </div>
                
                <div class="task-description">
                    <p class="mb-4">æƒ³è±¡ä½ å‘ç°äº†ä¸€ä¸ªç¥å¥‡çš„ä¸–ç•Œï¼Œè¿™ä¸ªä¸–ç•Œé‡Œæœ‰ä»€ä¹ˆå¥‡å¦™çš„äº‹ç‰©å‘¢ï¼Ÿ</p>
                    <p>è¯·ç”¨ç”ŸåŠ¨çš„è¯­è¨€æè¿°è¿™ä¸ªä¸–ç•Œçš„æ™¯è‰²ã€ä½åœ¨é‚£é‡Œçš„ç”Ÿç‰©ï¼Œä»¥åŠå‘ç”Ÿçš„æœ‰è¶£æ•…äº‹ã€‚è®©æˆ‘ä»¬ä¸€èµ·å‘æŒ¥æƒ³è±¡åŠ›ï¼Œåˆ›é€ ä¸€ä¸ªå±äºä½ çš„å¥‡å¹»ä¸–ç•Œå§ï¼</p>
                </div>

                <!-- ä»»åŠ¡è¦æ±‚ -->
                <div class="task-requirements">
                    <div class="requirements-header">
                        <i class="fas fa-clipboard-check text-amber-600 text-lg"></i>
                        <span class="requirements-title">å®Œæˆè¦æ±‚</span>
                    </div>
                    <ul class="requirements-list">
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>æè¿°è‡³å°‘3ç§ä¸åŒçš„å¥‡å¦™äº‹ç‰©</span>
                        </li>
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>ä½¿ç”¨ä¸°å¯Œçš„å½¢å®¹è¯è®©æè¿°æ›´ç”ŸåŠ¨</span>
                        </li>
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>å›ç­”å­—æ•°ä¸å°‘äº100å­—</span>
                        </li>
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>å‘æŒ¥æƒ³è±¡åŠ›ï¼Œåˆ›é€ ç‹¬ç‰¹çš„æ•…äº‹</span>
                        </li>
                    </ul>
                </div>

                <!-- æç¤ºå¡ç‰‡ -->
                <div class="hint-card">
                    <div class="hint-title">å°æç¤º</div>
                    <div class="hint-content">ä½ å¯ä»¥æƒ³è±¡å½©è‰²çš„äº‘æœµã€ä¼šè¯´è¯çš„èŠ±æœµã€å‹å–„çš„ç¥å¥‡åŠ¨ç‰©ï¼Œæˆ–è€…ä»»ä½•ä½ è§‰å¾—æœ‰è¶£çš„äº‹ç‰©ï¼</div>
                </div>

                <!-- AIäº’åŠ¨åŒºåŸŸ -->
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-robot"></i></div>
                    <span>AIå°åŠ©æ‰‹</span>
                </div>

                <div class="ai-interaction-area">
                    <div class="ai-assistant">
                        <div class="ai-avatar">ğŸ¤–</div>
                        <div class="ai-message">
                            å—¨ï¼æˆ‘æ˜¯ä½ çš„AIå°åŠ©æ‰‹ã€‚å¦‚æœä½ åœ¨æè¿°æ—¶é‡åˆ°å›°éš¾ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šç»™ä½ ä¸€äº›çµæ„Ÿæç¤ºå“¦ï¼æ¯”å¦‚ä½ å¯ä»¥ä»é¢œè‰²ã€å£°éŸ³ã€æ°”å‘³è¿™äº›æ„Ÿå®˜å‡ºå‘æ¥æè¿°ã€‚
                        </div>
                    </div>
                    
                    <button class="ai-help-btn" onclick="getAIHelp()">
                        <i class="fas fa-lightbulb"></i>
                        å‘AIåŠ©æ‰‹å¯»æ±‚å¸®åŠ©
                    </button>
                </div>

                <!-- ç¤ºä¾‹å±•ç¤º -->
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-eye"></i></div>
                    <span>å‚è€ƒç¤ºä¾‹</span>
                </div>

                <div class="example-card">
                    <div class="example-title">ä¼˜ç§€ä½œå“å‚è€ƒï¼š</div>
                    <div class="example-content">"åœ¨æˆ‘å‘ç°çš„ç¥å¥‡ä¸–ç•Œé‡Œï¼Œå¤©ç©ºæ˜¯ç²‰çº¢è‰²çš„ï¼Œäº‘æœµåƒæ£‰èŠ±ç³–ä¸€æ ·æŸ”è½¯ã€‚æ ‘æœ¨ä¼šå”±æ­Œï¼Œæ¯å½“å¾®é£å¹è¿‡ï¼Œå°±èƒ½å¬åˆ°ç¾å¦™çš„æ—‹å¾‹..."</div>
                </div>

                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-edit"></i></div>
                    <span>æˆ‘çš„å›ç­”</span>
                </div>

                <div class="timer-display">
                    <i class="fas fa-hourglass-half timer-icon"></i>
                    <span>å‰©ä½™æ—¶é—´ï¼š<span id="remainingTime">24åˆ†32ç§’</span></span>
                </div>

                <div class="input-area">
                    <textarea 
                        class="text-input" 
                        placeholder="åœ¨è¿™é‡Œæè¿°ä½ çš„ç¥å¥‡ä¸–ç•Œå§ï¼è®°å¾—è¦ç”ŸåŠ¨æœ‰è¶£å“¦..."
                        id="taskAnswer"
                        oninput="updateWordCount()"
                    ></textarea>
                    
                    <div class="input-tools">
                        <div class="tool-group">
                            <button class="tool-btn" onclick="insertEmoji()" title="æ’å…¥è¡¨æƒ…">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button class="tool-btn" onclick="toggleVoiceInput()" title="è¯­éŸ³è¾“å…¥">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="tool-btn" onclick="saveAsDraft()" title="ä¿å­˜è‰ç¨¿">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                        <div class="word-count">
                            <span id="wordCount">0</span>/100å­—
                        </div>
                    </div>
                </div>
            </div>

            <!-- æäº¤åŒºåŸŸ -->
            <div class="submit-area">
                <button class="submit-btn" id="submitBtn" onclick="submitTask()" disabled>
                    <i class="fas fa-paper-plane"></i>
                    <span>æäº¤æˆ‘çš„å›ç­”</span>
                </button>
                <p class="submit-hint">
                    æäº¤åå°†è·å¾—AIè¯¦ç»†åé¦ˆå’Œèƒ½åŠ›è¯„åˆ†
                </p>
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨å¸®åŠ©æŒ‰é’® -->
    <div class="floating-help" onclick="showHelp()" title="å¸®åŠ©">
        <i class="fas fa-question"></i>
    </div>

    <script>
        let timeRemaining = 25 * 60; // 25åˆ†é’Ÿ
        let timerInterval;
        let wordCount = 0;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
            loadDraft();
        });

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    autoSubmit();
                }
            }, 1000);
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('taskTimer').textContent = timeString;
            
            const remainingMinutes = Math.floor(timeRemaining / 60);
            const remainingSeconds = timeRemaining % 60;
            const remainingString = `${remainingMinutes}åˆ†${remainingSeconds}ç§’`;
            document.getElementById('remainingTime').textContent = remainingString;
        }

        // æ›´æ–°å­—æ•°ç»Ÿè®¡
        function updateWordCount() {
            const textarea = document.getElementById('taskAnswer');
            const text = textarea.value.trim();
            wordCount = text.length;
            
            document.getElementById('wordCount').textContent = wordCount;
            
            // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = wordCount < 50; // è‡³å°‘50å­—æ‰èƒ½æäº¤
            
            // è‡ªåŠ¨ä¿å­˜è‰ç¨¿
            if (wordCount > 0) {
                localStorage.setItem('taskDraft', text);
            }
        }

        // åŠ è½½è‰ç¨¿
        function loadDraft() {
            const draft = localStorage.getItem('taskDraft');
            if (draft) {
                document.getElementById('taskAnswer').value = draft;
                updateWordCount();
            }
        }

        // ä¿å­˜è‰ç¨¿
        function saveAsDraft() {
            const text = document.getElementById('taskAnswer').value;
            localStorage.setItem('taskDraft', text);
            showNotification('å·²ä¿å­˜', 'success');
        }

        // è·å–AIå¸®åŠ©
        function getAIHelp() {
            const tips = [
                "è¯•è¯•æè¿°ä¸€ä¸‹è¿™ä¸ªä¸–ç•Œçš„å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ",
                "æƒ³è±¡ä¸€ä¸‹é‚£é‡Œçš„åŠ¨ç‰©æœ‰ä»€ä¹ˆç‰¹æ®Šèƒ½åŠ›ï¼Ÿ",
                "è¿™ä¸ªä¸–ç•Œé‡Œçš„æ¤ç‰©å’Œæˆ‘ä»¬çš„æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ",
                "ä½ åœ¨è¿™ä¸ªä¸–ç•Œé‡Œé‡åˆ°äº†ä»€ä¹ˆæœ‰è¶£çš„æœ‹å‹ï¼Ÿ"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            showNotification(randomTip, 'info');
        }

        // æ’å…¥è¡¨æƒ…
        function insertEmoji() {
            const emojis = ['ğŸŒˆ', 'ğŸ¦„', 'âœ¨', 'ğŸŒ¸', 'ğŸˆ', 'ğŸ¨', 'ğŸ­', 'ğŸª', 'ğŸ¡', 'ğŸŒŸ'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const textarea = document.getElementById('taskAnswer');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            textarea.value = textBefore + randomEmoji + textAfter;
            textarea.setSelectionRange(cursorPos + 2, cursorPos + 2);
            textarea.focus();
            
            updateWordCount();
        }

        // è¯­éŸ³è¾“å…¥
        function toggleVoiceInput() {
            showNotification('è¯­éŸ³è¾“å…¥åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // æäº¤ä»»åŠ¡
        function submitTask() {
            const answer = document.getElementById('taskAnswer').value.trim();
            
            if (answer.length < 50) {
                MengyaUtils.Notification.error('å›ç­”å†…å®¹å¤ªå°‘ï¼Œè¯·è‡³å°‘å†™50ä¸ªå­—');
                return;
            }
            
            // æ¸…é™¤è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // ä¿å­˜ä»»åŠ¡å®Œæˆæ•°æ®åˆ°ç»Ÿä¸€æ•°æ®ç®¡ç†ç³»ç»Ÿ
            const completionData = {
                taskId: 'creative-world',
                answer: answer,
                wordCount: wordCount,
                timeUsed: (25 * 60) - timeRemaining,
                timestamp: Date.now(),
                score: Math.floor(Math.random() * 30) + 70, // 70-100åˆ†
                type: 'task_completion'
            };
            
            // ä½¿ç”¨ç»Ÿä¸€æ•°æ®ç®¡ç†
            MengyaUtils.Data.setData('child.lastTaskCompletion', completionData);
            MengyaUtils.Data.setData('child.progress.lastTaskCompleted', Date.now());
            
            // æ¸…ç†è‰ç¨¿
            localStorage.removeItem('taskDraft');
            
            MengyaUtils.Notification.success('æäº¤æˆåŠŸï¼æ­£åœ¨ç”Ÿæˆè¯„ä»·...');
            
            // è·³è½¬åˆ°ä»»åŠ¡åº†ç¥é¡µé¢
            setTimeout(() => {
                parent.postMessage({
                    type: 'openPage',
                    url: 'report-detail.html'
                }, '*');
            }, 1500);
        }

        // è‡ªåŠ¨æäº¤ï¼ˆæ—¶é—´åˆ°ï¼‰
        function autoSubmit() {
            const answer = document.getElementById('taskAnswer').value.trim();
            
            if (answer.length > 0) {
                showNotification('æ—¶é—´åˆ°ï¼æ­£åœ¨è‡ªåŠ¨æäº¤...', 'info');
                submitTask();
            } else {
                showNotification('æ—¶é—´åˆ°äº†ï¼Œä½†ä½ è¿˜æ²¡æœ‰å¼€å§‹å›ç­”å‘¢ï¼', 'error');
            }
        }

        // æ˜¾ç¤ºå¸®åŠ©
        function showHelp() {
            const helpText = `
ğŸ“ ä»»åŠ¡å¸®åŠ©

ğŸ¯ å¦‚ä½•å®Œæˆä»»åŠ¡ï¼š
â€¢ å‘æŒ¥æƒ³è±¡åŠ›ï¼Œæè¿°ä¸€ä¸ªç¥å¥‡ä¸–ç•Œ
â€¢ ä½¿ç”¨ç”ŸåŠ¨çš„è¯æ±‡è®©æè¿°æ›´ç²¾å½©
â€¢ ç¡®ä¿å†…å®¹ç§¯ææ­£é¢ï¼Œå¯Œæœ‰åˆ›æ„

â° æ—¶é—´ç®¡ç†ï¼š
â€¢ å»ºè®®ç”¨5åˆ†é’Ÿæ„æ€ï¼Œ20åˆ†é’Ÿå†™ä½œ
â€¢ å¯ä»¥éšæ—¶ä¿å­˜è‰ç¨¿
â€¢ æ—¶é—´åˆ°ä¼šè‡ªåŠ¨æäº¤

ğŸ’¡ å†™ä½œæŠ€å·§ï¼š
â€¢ ä»è§†è§‰ã€å¬è§‰ã€è§¦è§‰ç­‰æ„Ÿå®˜æè¿°
â€¢ å¯ä»¥åˆ›é€ æœ‰è¶£çš„è§’è‰²å’Œæ•…äº‹
â€¢ è®°å¾—æ£€æŸ¥é”™åˆ«å­—å“¦

ğŸ¤– AIåŠ©æ‰‹å¯ä»¥å¸®ä½ ï¼š
â€¢ æä¾›åˆ›æ„çµæ„Ÿ
â€¢ ç»™å‡ºå†™ä½œå»ºè®®
â€¢ è§£ç­”ç–‘é—®
            `;
            
            showNotification(helpText, 'info');
        }

        // é¡µé¢åˆå§‹åŒ–
        MengyaUtils.Lifecycle.onInit(() => {
            loadTaskData();
            setupTaskTimer();
            // åŒæ­¥ä»»åŠ¡è¿›åº¦æ•°æ®
            MengyaUtils.Data.syncData();
        });
        
        // åŠ è½½ä»»åŠ¡æ•°æ®
        async function loadTaskData() {
            const taskData = await MengyaUtils.Data.getData('child.currentTask');
            if (taskData) {
                updateTaskDisplay(taskData);
            }
        }
        
        // æ›´æ–°ä»»åŠ¡æ˜¾ç¤º
        function updateTaskDisplay(taskData) {
            // æ›´æ–°ä»»åŠ¡ä¿¡æ¯
            if (taskData.title) {
                document.querySelector('h1').textContent = taskData.title;
            }
            if (taskData.progress) {
                updateProgress(taskData.progress);
            }
        }
        
        // ä¿å­˜ä»»åŠ¡è¿›åº¦
        function saveTaskProgress(progress) {
            MengyaUtils.Data.setData('child.currentTask.progress', progress);
            MengyaUtils.Data.setData('child.progress.lastUpdated', Date.now());
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        });
    </script>
</body>
</html>
