<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ªªÂä°ËØ¶ÊÉÖ - ËêåËäΩAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="mengya-common.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .task-container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.15);
            overflow: hidden;
            margin: 12px;
        }
        
        .task-header {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            color: white;
            padding: 32px 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .task-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: headerGlow 6s ease-in-out infinite;
        }
        
        @keyframes headerGlow {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }
        
        .task-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: iconFloat 3s ease-in-out infinite;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-8px) scale(1.05); }
        }
        
        .task-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .task-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .difficulty-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .content-section {
            padding: 24px;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 20px;
        }
        
        .section-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        .task-description {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            line-height: 1.7;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .task-description::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8B5CF6, #EC4899);
        }
        
        .task-requirements {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
            position: relative;
        }
        
        .requirements-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .requirements-title {
            font-weight: 700;
            color: #92400e;
            font-size: 16px;
        }
        
        .requirements-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .requirements-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #92400e;
        }
        
        .requirement-check {
            width: 20px;
            height: 20px;
            background: #f59e0b;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            flex-shrink: 0;
            animation: checkPulse 2s infinite;
        }
        
        @keyframes checkPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .hint-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .hint-card::before {
            content: 'üí°';
            position: absolute;
            top: 16px;
            right: 20px;
            font-size: 24px;
            animation: bulbGlow 2s ease-in-out infinite;
        }
        
        @keyframes bulbGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .hint-title {
            font-weight: 700;
            color: #166534;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .hint-content {
            color: #166534;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .ai-interaction-area {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .ai-assistant {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .ai-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: avatarPulse 3s ease-in-out infinite;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        
        @keyframes avatarPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        
        .ai-message {
            flex: 1;
            background: white;
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.15);
            font-size: 15px;
            line-height: 1.6;
            position: relative;
        }
        
        .ai-message::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 20px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid white;
        }
        
        .ai-help-btn {
            width: 100%;
            background: white;
            border: 2px solid #0ea5e9;
            color: #0ea5e9;
            padding: 16px 20px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .ai-help-btn:hover {
            background: #0ea5e9;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.3);
        }
        
        .input-area {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            padding: 20px;
            transition: all 0.3s ease;
            margin-bottom: 24px;
        }
        
        .input-area:focus-within {
            border-color: #8B5CF6;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }
        
        .text-input {
            width: 100%;
            min-height: 140px;
            border: none;
            outline: none;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
            font-family: inherit;
        }
        
        .text-input::placeholder {
            color: #9ca3af;
        }
        
        .input-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
        
        .tool-group {
            display: flex;
            gap: 8px;
        }
        
        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            background: white;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tool-btn:hover {
            background: #f3f4f6;
            border-color: #8B5CF6;
            color: #8B5CF6;
            transform: translateY(-1px);
        }
        
        .word-count {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .timer-display {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 700;
            color: #92400e;
            font-size: 16px;
        }
        
        .timer-icon {
            animation: timerTick 1s infinite;
            font-size: 18px;
        }
        
        @keyframes timerTick {
            0%, 50% { transform: scale(1); }
            25% { transform: scale(1.15); }
        }
        
        .submit-area {
            padding: 24px;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border-top: 1px solid #e5e7eb;
        }
        
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .submit-hint {
            text-align: center;
            margin-top: 12px;
            font-size: 13px;
            color: #6b7280;
        }
        
        .floating-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #10B981, #059669);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
            animation: helpFloat 4s ease-in-out infinite;
        }
        
        @keyframes helpFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.5);
        }
        
        .example-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .example-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .example-content {
            font-size: 14px;
            color: #6b7280;
            font-style: italic;
            line-height: 1.6;
        }
        
        /* ÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-width: 768px) {
            .task-container {
                margin: 8px;
                border-radius: 20px;
            }
            
            .content-section {
                padding: 20px;
            }
            
            .task-icon {
                font-size: 56px;
            }
            
            .task-title {
                font-size: 24px;
            }
            
            .ai-assistant {
                gap: 12px;
            }
            
            .ai-avatar {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- È°∂ÈÉ®ÂØºËà™ -->
    <div class="gradient-bg px-6 py-6 text-white">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all" onclick="navigateBack()">
                    <i class="fas fa-arrow-left text-sm"></i>
                </button>
                <h1 class="text-xl font-bold">‰ªäÊó•‰ªªÂä°</h1>
            </div>
            <div class="text-sm opacity-90">
                <i class="fas fa-clock mr-1"></i>
                <span id="taskTimer">25:00</span>
            </div>
        </div>
        
        <!-- ‰ªªÂä°ËøõÂ∫¶ -->
        <div class="bg-white bg-opacity-15 rounded-xl p-4 mt-4 backdrop-blur-sm border border-white border-opacity-20">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium">‰ªªÂä°ËøõÂ∫¶</span>
                <span class="text-sm">30%</span>
            </div>
            <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                <div class="bg-white h-2 rounded-full transition-all duration-1000" style="width: 30%"></div>
            </div>
        </div>
    </div>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπ -->
    <div class="pb-20">
        <div class="task-container">
            <!-- ‰ªªÂä°Â§¥ÈÉ® -->
            <div class="task-header">
                <div class="task-icon">üé®</div>
                <h2 class="task-title">ÂàõÊÑèË°®ËææÊåëÊàò</h2>
                <p class="task-subtitle">Áî®‰Ω†ÁöÑÊÉ≥Ë±°ÂäõÊèèËø∞‰∏Ä‰∏™Á•ûÂ•áÁöÑ‰∏ñÁïå</p>
                <div class="difficulty-badge">
                    <i class="fas fa-star"></i>
                    <span>‰∏≠Á≠âÈöæÂ∫¶</span>
                </div>
            </div>

            <!-- ‰ªªÂä°ÊèèËø∞ -->
            <div class="content-section">
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-info"></i></div>
                    <span>‰ªªÂä°ÊèèËø∞</span>
                </div>
                
                <div class="task-description">
                    <p class="mb-4">ÊÉ≥Ë±°‰Ω†ÂèëÁé∞‰∫Ü‰∏Ä‰∏™Á•ûÂ•áÁöÑ‰∏ñÁïåÔºåËøô‰∏™‰∏ñÁïåÈáåÊúâ‰ªÄ‰πàÂ•áÂ¶ôÁöÑ‰∫ãÁâ©Âë¢Ôºü</p>
                    <p>ËØ∑Áî®ÁîüÂä®ÁöÑËØ≠Ë®ÄÊèèËø∞Ëøô‰∏™‰∏ñÁïåÁöÑÊôØËâ≤„ÄÅ‰ΩèÂú®ÈÇ£ÈáåÁöÑÁîüÁâ©Ôºå‰ª•ÂèäÂèëÁîüÁöÑÊúâË∂£ÊïÖ‰∫ã„ÄÇËÆ©Êàë‰ª¨‰∏ÄËµ∑ÂèëÊå•ÊÉ≥Ë±°ÂäõÔºåÂàõÈÄ†‰∏Ä‰∏™Â±û‰∫é‰Ω†ÁöÑÂ•áÂπª‰∏ñÁïåÂêßÔºÅ</p>
                </div>

                <!-- ‰ªªÂä°Ë¶ÅÊ±Ç -->
                <div class="task-requirements">
                    <div class="requirements-header">
                        <i class="fas fa-clipboard-check text-amber-600 text-lg"></i>
                        <span class="requirements-title">ÂÆåÊàêË¶ÅÊ±Ç</span>
                    </div>
                    <ul class="requirements-list">
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>ÊèèËø∞Ëá≥Â∞ë3Áßç‰∏çÂêåÁöÑÂ•áÂ¶ô‰∫ãÁâ©</span>
                        </li>
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>‰ΩøÁî®‰∏∞ÂØåÁöÑÂΩ¢ÂÆπËØçËÆ©ÊèèËø∞Êõ¥ÁîüÂä®</span>
                        </li>
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>ÂõûÁ≠îÂ≠óÊï∞‰∏çÂ∞ë‰∫é100Â≠ó</span>
                        </li>
                        <li>
                            <div class="requirement-check">
                                <i class="fas fa-check"></i>
                            </div>
                            <span>ÂèëÊå•ÊÉ≥Ë±°ÂäõÔºåÂàõÈÄ†Áã¨ÁâπÁöÑÊïÖ‰∫ã</span>
                        </li>
                    </ul>
                </div>

                <!-- ÊèêÁ§∫Âç°Áâá -->
                <div class="hint-card">
                    <div class="hint-title">Â∞èÊèêÁ§∫</div>
                    <div class="hint-content">‰Ω†ÂèØ‰ª•ÊÉ≥Ë±°ÂΩ©Ëâ≤ÁöÑ‰∫ëÊúµ„ÄÅ‰ºöËØ¥ËØùÁöÑËä±Êúµ„ÄÅÂèãÂñÑÁöÑÁ•ûÂ•áÂä®Áâ©ÔºåÊàñËÄÖ‰ªª‰Ωï‰Ω†ËßâÂæóÊúâË∂£ÁöÑ‰∫ãÁâ©ÔºÅ</div>
                </div>

                <!-- AI‰∫íÂä®Âå∫Âüü -->
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-robot"></i></div>
                    <span>AIÂ∞èÂä©Êâã</span>
                </div>

                <div class="ai-interaction-area">
                    <div class="ai-assistant">
                        <div class="ai-avatar">ü§ñ</div>
                        <div class="ai-message">
                            Âó®ÔºÅÊàëÊòØ‰Ω†ÁöÑAIÂ∞èÂä©Êâã„ÄÇÂ¶ÇÊûú‰Ω†Âú®ÊèèËø∞Êó∂ÈÅáÂà∞Âõ∞ÈöæÔºåÂèØ‰ª•ÂëäËØâÊàëÔºåÊàë‰ºöÁªô‰Ω†‰∏Ä‰∫õÁÅµÊÑüÊèêÁ§∫Âì¶ÔºÅÊØîÂ¶Ç‰Ω†ÂèØ‰ª•‰ªéÈ¢úËâ≤„ÄÅÂ£∞Èü≥„ÄÅÊ∞îÂë≥Ëøô‰∫õÊÑüÂÆòÂá∫ÂèëÊù•ÊèèËø∞„ÄÇ
                        </div>
                    </div>
                    
                    <button class="ai-help-btn" onclick="getAIHelp()">
                        <i class="fas fa-lightbulb"></i>
                        ÂêëAIÂä©ÊâãÂØªÊ±ÇÂ∏ÆÂä©
                    </button>
                </div>

                <!-- Á§∫‰æãÂ±ïÁ§∫ -->
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-eye"></i></div>
                    <span>ÂèÇËÄÉÁ§∫‰æã</span>
                </div>

                <div class="example-card">
                    <div class="example-title">‰ºòÁßÄ‰ΩúÂìÅÂèÇËÄÉÔºö</div>
                    <div class="example-content">"Âú®ÊàëÂèëÁé∞ÁöÑÁ•ûÂ•á‰∏ñÁïåÈáåÔºåÂ§©Á©∫ÊòØÁ≤âÁ∫¢Ëâ≤ÁöÑÔºå‰∫ëÊúµÂÉèÊ£âËä±Á≥ñ‰∏ÄÊ†∑ÊüîËΩØ„ÄÇÊ†ëÊú®‰ºöÂî±Ê≠åÔºåÊØèÂΩìÂæÆÈ£éÂêπËøáÔºåÂ∞±ËÉΩÂê¨Âà∞ÁæéÂ¶ôÁöÑÊóãÂæã..."</div>
                </div>

                <!-- ËæìÂÖ•Âå∫Âüü -->
                <div class="section-title">
                    <div class="section-icon"><i class="fas fa-edit"></i></div>
                    <span>ÊàëÁöÑÂõûÁ≠î</span>
                </div>

                <div class="timer-display">
                    <i class="fas fa-hourglass-half timer-icon"></i>
                    <span>Ââ©‰ΩôÊó∂Èó¥Ôºö<span id="remainingTime">24ÂàÜ32Áßí</span></span>
                </div>

                <div class="input-area">
                    <textarea 
                        class="text-input" 
                        placeholder="Âú®ËøôÈáåÊèèËø∞‰Ω†ÁöÑÁ•ûÂ•á‰∏ñÁïåÂêßÔºÅËÆ∞ÂæóË¶ÅÁîüÂä®ÊúâË∂£Âì¶..."
                        id="taskAnswer"
                        oninput="updateWordCount()"
                    ></textarea>
                    
                    <div class="input-tools">
                        <div class="tool-group">
                            <button class="tool-btn" onclick="insertEmoji()" title="ÊèíÂÖ•Ë°®ÊÉÖ">
                                <i class="fas fa-smile"></i>
                            </button>
                            <button class="tool-btn" onclick="toggleVoiceInput()" title="ËØ≠Èü≥ËæìÂÖ•">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="tool-btn" onclick="saveAsDraft()" title="‰øùÂ≠òËçâÁ®ø">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                        <div class="word-count">
                            <span id="wordCount">0</span>/100Â≠ó
                        </div>
                    </div>
                </div>
            </div>

            <!-- Êèê‰∫§Âå∫Âüü -->
            <div class="submit-area">
                <button class="submit-btn" id="submitBtn" onclick="submitTask()" disabled>
                    <i class="fas fa-paper-plane"></i>
                    <span>Êèê‰∫§ÊàëÁöÑÂõûÁ≠î</span>
                </button>
                <p class="submit-hint">
                    Êèê‰∫§ÂêéÂ∞ÜËé∑ÂæóAIËØ¶ÁªÜÂèçÈ¶àÂíåËÉΩÂäõËØÑÂàÜ
                </p>
            </div>
        </div>
    </div>

    <!-- ÊµÆÂä®Â∏ÆÂä©ÊåâÈíÆ -->
    <div class="floating-help" onclick="showHelp()" title="Â∏ÆÂä©">
        <i class="fas fa-question"></i>
    </div>

    <script>
        let timeRemaining = 25 * 60; // 25ÂàÜÈíü
        let timerInterval;
        let wordCount = 0;

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
            loadDraft();
        });

        // ÂºÄÂßãËÆ°Êó∂Âô®
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    autoSubmit();
                }
            }, 1000);
        }

        // Êõ¥Êñ∞ËÆ°Êó∂Âô®ÊòæÁ§∫
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('taskTimer').textContent = timeString;
            
            const remainingMinutes = Math.floor(timeRemaining / 60);
            const remainingSeconds = timeRemaining % 60;
            const remainingString = `${remainingMinutes}ÂàÜ${remainingSeconds}Áßí`;
            document.getElementById('remainingTime').textContent = remainingString;
        }

        // Êõ¥Êñ∞Â≠óÊï∞ÁªüËÆ°
        function updateWordCount() {
            const textarea = document.getElementById('taskAnswer');
            const text = textarea.value.trim();
            wordCount = text.length;
            
            document.getElementById('wordCount').textContent = wordCount;
            
            // Êõ¥Êñ∞Êèê‰∫§ÊåâÈíÆÁä∂ÊÄÅ
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = wordCount < 50; // Ëá≥Â∞ë50Â≠óÊâçËÉΩÊèê‰∫§
            
            // Ëá™Âä®‰øùÂ≠òËçâÁ®ø
            if (wordCount > 0) {
                localStorage.setItem('taskDraft', text);
            }
        }

        // Âä†ËΩΩËçâÁ®ø
        function loadDraft() {
            const draft = localStorage.getItem('taskDraft');
            if (draft) {
                document.getElementById('taskAnswer').value = draft;
                updateWordCount();
            }
        }

        // ‰øùÂ≠òËçâÁ®ø
        function saveAsDraft() {
            const text = document.getElementById('taskAnswer').value;
            localStorage.setItem('taskDraft', text);
            showNotification('Â∑≤‰øùÂ≠ò', 'success');
        }

        // Ëé∑ÂèñAIÂ∏ÆÂä©
        function getAIHelp() {
            const tips = [
                "ËØïËØïÊèèËø∞‰∏Ä‰∏ãËøô‰∏™‰∏ñÁïåÁöÑÂ§©Á©∫ÊòØ‰ªÄ‰πàÈ¢úËâ≤ÁöÑÔºü",
                "ÊÉ≥Ë±°‰∏Ä‰∏ãÈÇ£ÈáåÁöÑÂä®Áâ©Êúâ‰ªÄ‰πàÁâπÊÆäËÉΩÂäõÔºü",
                "Ëøô‰∏™‰∏ñÁïåÈáåÁöÑÊ§çÁâ©ÂíåÊàë‰ª¨ÁöÑÊúâ‰ªÄ‰πà‰∏çÂêåÔºü",
                "‰Ω†Âú®Ëøô‰∏™‰∏ñÁïåÈáåÈÅáÂà∞‰∫Ü‰ªÄ‰πàÊúâË∂£ÁöÑÊúãÂèãÔºü"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            showNotification(randomTip, 'info');
        }

        // ÊèíÂÖ•Ë°®ÊÉÖ
        function insertEmoji() {
            const emojis = ['üåà', 'ü¶Ñ', '‚ú®', 'üå∏', 'üéà', 'üé®', 'üé≠', 'üé™', 'üé°', 'üåü'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const textarea = document.getElementById('taskAnswer');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            textarea.value = textBefore + randomEmoji + textAfter;
            textarea.setSelectionRange(cursorPos + 2, cursorPos + 2);
            textarea.focus();
            
            updateWordCount();
        }

        // ËØ≠Èü≥ËæìÂÖ•
        function toggleVoiceInput() {
            showNotification('ËØ≠Èü≥ËæìÂÖ•ÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
        }

        // Êèê‰∫§‰ªªÂä°
        function submitTask() {
            const answer = document.getElementById('taskAnswer').value.trim();
            
            if (answer.length < 50) {
                MengyaUtils.Notification.error('ÂõûÁ≠îÂÜÖÂÆπÂ§™Â∞ëÔºåËØ∑Ëá≥Â∞ëÂÜô50‰∏™Â≠ó');
                return;
            }
            
            // Ê∏ÖÈô§ËÆ°Êó∂Âô®
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // ‰øùÂ≠ò‰ªªÂä°ÂÆåÊàêÊï∞ÊçÆÂà∞Áªü‰∏ÄÊï∞ÊçÆÁÆ°ÁêÜÁ≥ªÁªü
            const completionData = {
                taskId: 'creative-world',
                answer: answer,
                wordCount: wordCount,
                timeUsed: (25 * 60) - timeRemaining,
                timestamp: Date.now(),
                score: Math.floor(Math.random() * 30) + 70, // 70-100ÂàÜ
                type: 'task_completion'
            };
            
            // ‰ΩøÁî®Áªü‰∏ÄÊï∞ÊçÆÁÆ°ÁêÜ
            MengyaUtils.Data.setData('child.lastTaskCompletion', completionData);
            MengyaUtils.Data.setData('child.progress.lastTaskCompleted', Date.now());
            
            // Ê∏ÖÁêÜËçâÁ®ø
            localStorage.removeItem('taskDraft');
            
            MengyaUtils.Notification.success('Êèê‰∫§ÊàêÂäüÔºÅÊ≠£Âú®ÁîüÊàêËØÑ‰ª∑...');
            
            // Ë∑≥ËΩ¨Âà∞‰ªªÂä°Â∫ÜÁ•ùÈ°µÈù¢
            setTimeout(() => {
                parent.postMessage({
                    type: 'openPage',
                    url: 'report-detail.html'
                }, '*');
            }, 1500);
        }

        // Ëá™Âä®Êèê‰∫§ÔºàÊó∂Èó¥Âà∞Ôºâ
        function autoSubmit() {
            const answer = document.getElementById('taskAnswer').value.trim();
            
            if (answer.length > 0) {
                showNotification('Êó∂Èó¥Âà∞ÔºÅÊ≠£Âú®Ëá™Âä®Êèê‰∫§...', 'info');
                submitTask();
            } else {
                showNotification('Êó∂Èó¥Âà∞‰∫ÜÔºå‰ΩÜ‰Ω†ËøòÊ≤°ÊúâÂºÄÂßãÂõûÁ≠îÂë¢ÔºÅ', 'error');
            }
        }

        // ÊòæÁ§∫Â∏ÆÂä©
        function showHelp() {
            const helpText = `
üìù ‰ªªÂä°Â∏ÆÂä©

üéØ Â¶Ç‰ΩïÂÆåÊàê‰ªªÂä°Ôºö
‚Ä¢ ÂèëÊå•ÊÉ≥Ë±°ÂäõÔºåÊèèËø∞‰∏Ä‰∏™Á•ûÂ•á‰∏ñÁïå
‚Ä¢ ‰ΩøÁî®ÁîüÂä®ÁöÑËØçÊ±áËÆ©ÊèèËø∞Êõ¥Á≤æÂΩ©
‚Ä¢ Á°Æ‰øùÂÜÖÂÆπÁßØÊûÅÊ≠£Èù¢ÔºåÂØåÊúâÂàõÊÑè

‚è∞ Êó∂Èó¥ÁÆ°ÁêÜÔºö
‚Ä¢ Âª∫ËÆÆÁî®5ÂàÜÈíüÊûÑÊÄùÔºå20ÂàÜÈíüÂÜô‰Ωú
‚Ä¢ ÂèØ‰ª•ÈöèÊó∂‰øùÂ≠òËçâÁ®ø
‚Ä¢ Êó∂Èó¥Âà∞‰ºöËá™Âä®Êèê‰∫§

üí° ÂÜô‰ΩúÊäÄÂ∑ßÔºö
‚Ä¢ ‰ªéËßÜËßâ„ÄÅÂê¨Ëßâ„ÄÅËß¶ËßâÁ≠âÊÑüÂÆòÊèèËø∞
‚Ä¢ ÂèØ‰ª•ÂàõÈÄ†ÊúâË∂£ÁöÑËßíËâ≤ÂíåÊïÖ‰∫ã
‚Ä¢ ËÆ∞ÂæóÊ£ÄÊü•ÈîôÂà´Â≠óÂì¶

ü§ñ AIÂä©ÊâãÂèØ‰ª•Â∏Æ‰Ω†Ôºö
‚Ä¢ Êèê‰æõÂàõÊÑèÁÅµÊÑü
‚Ä¢ ÁªôÂá∫ÂÜô‰ΩúÂª∫ËÆÆ
‚Ä¢ Ëß£Á≠îÁñëÈóÆ
            `;
            
            showNotification(helpText, 'info');
        }

        // È°µÈù¢ÂàùÂßãÂåñ
        MengyaUtils.Lifecycle.onInit(() => {
            loadTaskData();
            setupTaskTimer();
            // ÂêåÊ≠•‰ªªÂä°ËøõÂ∫¶Êï∞ÊçÆ
            MengyaUtils.Data.syncData();
        });
        
        // Âä†ËΩΩ‰ªªÂä°Êï∞ÊçÆ
        async function loadTaskData() {
            const taskData = await MengyaUtils.Data.getData('child.currentTask');
            if (taskData) {
                updateTaskDisplay(taskData);
            }
        }
        
        // Êõ¥Êñ∞‰ªªÂä°ÊòæÁ§∫
        function updateTaskDisplay(taskData) {
            // Êõ¥Êñ∞‰ªªÂä°‰ø°ÊÅØ
            if (taskData.title) {
                document.querySelector('h1').textContent = taskData.title;
            }
            if (taskData.progress) {
                updateProgress(taskData.progress);
            }
        }
        
        // ‰øùÂ≠ò‰ªªÂä°ËøõÂ∫¶
        function saveTaskProgress(progress) {
            MengyaUtils.Data.setData('child.currentTask.progress', progress);
            MengyaUtils.Data.setData('child.progress.lastUpdated', Date.now());
        }

        // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜ
        window.addEventListener('beforeunload', function() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        });
    </script>
</body>
</html>
