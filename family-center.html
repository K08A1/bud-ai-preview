<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­äº’åŠ¨ä¸­å¿ƒ - èŒèŠ½AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="mengya-common.js"></script>
    <script src="learning-analytics.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #45B7D1 100%);
        }
        .family-container {
            background: white;
            border-radius: 25px 25px 0 0;
            min-height: calc(100vh - 120px);
            position: relative;
            overflow: hidden;
        }
        .family-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4);
            animation: familyFlow 4s ease-in-out infinite;
        }
        @keyframes familyFlow {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        .hero-section {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.05), transparent);
            animation: heroShine 3s infinite;
        }
        @keyframes heroShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        .activity-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.05), transparent);
            transition: left 0.6s;
        }
        .activity-card:hover::before {
            left: 100%;
        }
        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(255, 107, 107, 0.15);
            border-color: rgba(255, 107, 107, 0.3);
        }
        .challenge-badge {
            background: linear-gradient(135deg, #FFD93D, #FF6B6B);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 12px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4ECDC4, #45B7D1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 12px;
            border: 3px solid white;
            box-shadow: 0 4px 20px rgba(78, 205, 196, 0.3);
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ECDC4, #45B7D1);
            border-radius: 4px;
            transition: width 1s ease-in-out;
        }
        .floating-hearts {
            position: absolute;
            top: 20px;
            right: 20px;
            animation: floatingHearts 3s ease-in-out infinite;
        }
        @keyframes floatingHearts {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        .activity-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 16px;
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }
        .family-stats {
            background: linear-gradient(135deg, rgba(150, 206, 180, 0.1), rgba(69, 183, 209, 0.1));
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
        }
        .interaction-bubble {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            border: 1px solid rgba(255, 107, 107, 0.2);
            border-radius: 20px;
            padding: 16px;
            margin: 12px 0;
            position: relative;
            overflow: hidden;
        }
        .interaction-bubble::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            animation: bubbleShimmer 3s infinite;
        }
        @keyframes bubbleShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        .celebration-mode {
            animation: celebration 2s ease-in-out;
        }
        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* æ–°å¢æ ·å¼ */
        .real-time-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
            display: inline-block;
            margin-left: 8px;
        }
        
        .weather-widget {
            background: linear-gradient(135deg, #87CEEB, #ADD8E6);
            border-radius: 16px;
            padding: 16px;
            color: white;
            text-align: center;
        }
        
        .family-mood {
            background: linear-gradient(135deg, #FFE4E1, #FFF0F5);
            border-radius: 16px;
            padding: 16px;
            border: 2px solid rgba(255, 182, 193, 0.3);
        }
        
        .schedule-item {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #4ECDC4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .notification-badge {
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            position: absolute;
            top: -6px;
            right: -6px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        
        .tab-container {
            background: white;
            border-radius: 20px 20px 0 0;
            margin-top: 16px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .tab-button {
            flex: 1;
            padding: 16px 8px;
            text-align: center;
            background: none;
            border: none;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            color: #4ECDC4;
            border-bottom: 2px solid #4ECDC4;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .voice-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 12px 16px;
            margin: 8px 0;
            position: relative;
        }
        
        .smart-suggestion {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 16px;
            margin: 12px 0;
        }
        
        .mini-game-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .mini-game-card:hover {
            transform: translateY(-4px);
        }

        /* è®¡åˆ’åŠŸèƒ½å¢å¼ºæ ·å¼ */
        .schedule-view-btn {
            padding: 6px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #6b7280;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .schedule-view-btn.active {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .schedule-stats {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 12px;
            padding: 16px;
        }

        .stat-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
        }

        .quick-add-section {
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .quick-plan-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            color: #6b7280;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .quick-plan-btn:hover {
            border-color: #10b981;
            color: #10b981;
            transform: translateY(-1px);
        }

        .schedule-list {
            max-height: 400px;
            overflow-y: auto;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .participant-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .participant-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .participant-checkbox:hover {
            border-color: #10b981;
        }

        .participant-checkbox input:checked + span {
            color: #10b981;
            font-weight: 600;
        }

        .activity-type-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .activity-type-btn {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #6b7280;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .activity-type-btn.active {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .activity-type-btn:hover {
            border-color: #10b981;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #6b7280;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* è®¡åˆ’é¡¹å¢å¼ºæ ·å¼ */
        .schedule-item-enhanced {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s;
        }

        .schedule-item-enhanced.completed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }

        .schedule-item-enhanced.current {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .schedule-item-enhanced.pending {
            border-left-color: #6b7280;
        }

        .schedule-item-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .plan-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 16px;
        }

        .plan-time {
            background: #f3f4f6;
            color: #6b7280;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .plan-participants {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .plan-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            padding: 6px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            color: #6b7280;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #f9fafb;
            border-color: #10b981;
            color: #10b981;
        }

        .action-btn.primary {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .action-btn.primary:hover {
            background: #059669;
        }

        /* é€šçŸ¥å¼¹çª—æ ·å¼ */
        .notification-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            padding: 20px;
        }

        .notification-modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 80px;
        }

        .notification-panel {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            max-height: 70vh;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .notification-body {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: #f8fafc;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item.unread {
            background: #f0f9ff;
            border-left: 3px solid #3b82f6;
        }

        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .notification-icon.success {
            background: #dcfce7;
            color: #16a34a;
        }

        .notification-icon.info {
            background: #dbeafe;
            color: #2563eb;
        }

        .notification-icon.warning {
            background: #fef3c7;
            color: #d97706;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .notification-message {
            color: #6b7280;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .notification-time {
            color: #9ca3af;
            font-size: 11px;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .notification-btn {
            padding: 4px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            color: #6b7280;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .notification-btn:hover {
            background: #f9fafb;
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .notification-btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .notification-btn.primary:hover {
            background: #2563eb;
        }

        .notification-footer {
            padding: 16px 20px;
            background: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-footer button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mark-all-read {
            background: #f1f5f9;
            color: #64748b;
        }

        .mark-all-read:hover {
            background: #e2e8f0;
        }

        .view-all {
            background: #3b82f6;
            color: white;
        }

        .view-all:hover {
            background: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="gradient-bg px-6 py-4">
        <div class="flex items-center justify-between">
            <button onclick="navigateBack()" class="text-white text-xl">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="text-center flex-1">
                <h1 class="text-white text-lg font-bold">å®¶åº­äº’åŠ¨ä¸­å¿ƒ</h1>
                <p class="text-white text-sm opacity-90">ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·æˆé•¿</p>
            </div>
            <div class="relative">
                <button onclick="showNotifications()" class="text-white text-xl relative">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge" id="notificationBadge">3</div>
                </button>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="family-container">
        <!-- è‹±é›„åŒºåŸŸ - å¢å¼ºç‰ˆ -->
        <div class="hero-section">
            <div class="floating-hearts">
                <i class="fas fa-heart text-red-400 text-lg"></i>
            </div>
            <div class="text-6xl mb-4">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2" id="familyGreeting">æ¬¢è¿æ¥åˆ°å®¶åº­å­¦ä¹ ä¹å›­</h2>
            <p class="text-gray-600 text-sm" id="familyMotivation">ä»Šå¤©åˆæ˜¯å……æ»¡çˆ±ä¸å­¦ä¹ çš„ç¾å¥½ä¸€å¤©ï¼</p>
            
            <!-- ä»Šæ—¥å¤©æ°”å’Œå¿ƒæƒ… -->
            <div class="grid grid-cols-2 gap-4 mt-6">
                <div class="weather-widget">
                    <div class="text-2xl mb-2">â˜€ï¸</div>
                    <div class="text-sm">
                        <div class="font-semibold">ä»Šæ—¥å¤©æ°”</div>
                        <div id="weatherInfo">æ™´å¤© 22Â°C</div>
                    </div>
                </div>
                <div class="family-mood">
                    <div class="text-2xl mb-2">ğŸ˜Š</div>
                    <div class="text-sm text-gray-700">
                        <div class="font-semibold">å®¶åº­å¿ƒæƒ…</div>
                        <div id="familyMoodText">å¿«ä¹æ„‰æ‚¦</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µå®¹å™¨ -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('overview')">
                    <i class="fas fa-home mr-1"></i>æ€»è§ˆ
                </button>
                <button class="tab-button" onclick="switchTab('schedule')">
                    <i class="fas fa-calendar mr-1"></i>è®¡åˆ’
                </button>
                <button class="tab-button" onclick="switchTab('communication')">
                    <i class="fas fa-comments mr-1"></i>æ²Ÿé€š
                </button>
                <button class="tab-button" onclick="switchTab('games')">
                    <i class="fas fa-gamepad mr-1"></i>æ¸¸æˆ
                </button>
            </div>

            <!-- æ€»è§ˆæ ‡ç­¾é¡µ -->
            <div class="tab-content active" id="overviewTab">
                <!-- å®¶åº­ç»Ÿè®¡æ¦‚è§ˆ - å¢å¼ºç‰ˆ -->
                <div class="family-stats">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-blue-600"></i>
                        ä»Šæ—¥å®¶åº­å­¦ä¹ æ¦‚å†µ
                        <div class="real-time-indicator"></div>
                    </h3>
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div>
                            <div class="text-2xl font-bold text-blue-600" id="todayActivities">3</div>
                            <div class="text-xs text-gray-600">å…±åŒæ´»åŠ¨</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-green-600" id="familyScore">150</div>
                            <div class="text-xs text-gray-600">å®¶åº­ç§¯åˆ†</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-purple-600" id="interactionTime">45min</div>
                            <div class="text-xs text-gray-600">äº’åŠ¨æ—¶é•¿</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-orange-600" id="completionRate">92%</div>
                            <div class="text-xs text-gray-600">å®Œæˆç‡</div>
                        </div>
                    </div>
                </div>

                <!-- æ™ºèƒ½æ¨èæ´»åŠ¨ -->
                <div class="px-6 py-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-brain mr-2 text-purple-500"></i>
                        AIæ™ºèƒ½æ¨è
                    </h3>
                    <div class="smart-suggestion">
                        <div class="flex items-start space-x-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800 mb-2">ä»Šæ—¥æ¨èï¼šåˆ›æ„æ•…äº‹æ—¶å…‰</h4>
                                <p class="text-sm text-gray-600 mb-3">æ ¹æ®å°æ˜çš„å­¦ä¹ è¿›åº¦å’Œå…´è¶£åå¥½ï¼Œå»ºè®®è¿›è¡Œåˆ›æ„æ•…äº‹åˆ›ä½œï¼Œæœ‰åŠ©äºæå‡è¯­è¨€è¡¨è¾¾å’Œæƒ³è±¡åŠ›ã€‚</p>
                                <div class="flex space-x-2">
                                    <button onclick="startRecommendedActivity('story')" class="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-semibold hover:bg-purple-600">
                                        ç«‹å³å¼€å§‹
                                    </button>
                                    <button onclick="getMoreRecommendations()" class="px-4 py-2 border border-purple-500 text-purple-500 rounded-lg text-sm font-semibold hover:bg-purple-50">
                                        æ›´å¤šæ¨è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å®¶åº­æˆå‘˜çŠ¶æ€ - å¢å¼ºç‰ˆ -->
                <div class="px-6 py-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-users mr-2 text-indigo-500"></i>
                        å®¶åº­æˆå‘˜åŠ¨æ€
                    </h3>
                    <div id="familyMembers" class="space-y-3">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- è®¡åˆ’æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="scheduleTab">
                <!-- è®¡åˆ’ç®¡ç†å¤´éƒ¨ -->
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-calendar-alt mr-2 text-green-500"></i>
                        å®¶åº­å­¦ä¹ è®¡åˆ’
                    </h3>
                    <div class="flex space-x-2">
                        <button onclick="switchScheduleView('today')" class="schedule-view-btn active" id="todayViewBtn">
                            <i class="fas fa-calendar-day mr-1"></i>ä»Šæ—¥
                        </button>
                        <button onclick="switchScheduleView('week')" class="schedule-view-btn" id="weekViewBtn">
                            <i class="fas fa-calendar-week mr-1"></i>æœ¬å‘¨
                        </button>
                    </div>
                </div>

                <!-- è®¡åˆ’ç»Ÿè®¡æ¦‚è§ˆ -->
                <div class="schedule-stats mb-4">
                    <div class="grid grid-cols-3 gap-3 text-center">
                        <div class="stat-item">
                            <div class="text-lg font-bold text-blue-600" id="todayPlansCount">4</div>
                            <div class="text-xs text-gray-600">ä»Šæ—¥è®¡åˆ’</div>
                        </div>
                        <div class="stat-item">
                            <div class="text-lg font-bold text-green-600" id="completedPlansCount">2</div>
                            <div class="text-xs text-gray-600">å·²å®Œæˆ</div>
                        </div>
                        <div class="stat-item">
                            <div class="text-lg font-bold text-orange-600" id="pendingPlansCount">2</div>
                            <div class="text-xs text-gray-600">å¾…æ‰§è¡Œ</div>
                        </div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæ·»åŠ è®¡åˆ’ -->
                <div class="quick-add-section mb-4">
                    <div class="flex space-x-2">
                        <button onclick="addQuickPlan('å­¦ä¹ ')" class="quick-plan-btn">
                            <i class="fas fa-book mr-1"></i>å­¦ä¹ 
                        </button>
                        <button onclick="addQuickPlan('æ¸¸æˆ')" class="quick-plan-btn">
                            <i class="fas fa-gamepad mr-1"></i>æ¸¸æˆ
                        </button>
                        <button onclick="addQuickPlan('è¿åŠ¨')" class="quick-plan-btn">
                            <i class="fas fa-running mr-1"></i>è¿åŠ¨
                        </button>
                        <button onclick="addQuickPlan('åˆ›ä½œ')" class="quick-plan-btn">
                            <i class="fas fa-paint-brush mr-1"></i>åˆ›ä½œ
                        </button>
                    </div>
                </div>

                <!-- è®¡åˆ’åˆ—è¡¨ -->
                <div id="scheduleList" class="schedule-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- æ·»åŠ è®¡åˆ’æŒ‰é’® -->
                <button onclick="showAddScheduleModal()" class="w-full mt-4 py-3 border-2 border-dashed border-gray-300 text-gray-500 rounded-lg hover:border-green-400 hover:text-green-500 transition-colors">
                    <i class="fas fa-plus mr-2"></i>åˆ›å»ºè¯¦ç»†è®¡åˆ’
                </button>
            </div>

            <!-- æ²Ÿé€šæ ‡ç­¾é¡µ -->
            <div class="tab-content" id="communicationTab">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-heart mr-2 text-red-500"></i>
                    å®¶åº­ç•™è¨€æ¿
                </h3>
                <div id="familyMessages" class="space-y-3 mb-4">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="flex space-x-2">
                    <input type="text" id="messageInput" placeholder="ç»™å®¶äººç•™è¨€..." class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="sendVoiceMessage()" class="px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button onclick="sendMessage()" class="px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ¸¸æˆæ ‡ç­¾é¡µ -->
            <div class="tab-content" id="gamesTab">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-gamepad mr-2 text-orange-500"></i>
                    å®¶åº­å°æ¸¸æˆ
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="mini-game-card" onclick="startMiniGame('word')">
                        <div class="text-3xl mb-2">ğŸ”¤</div>
                        <div class="font-semibold text-gray-800">è¯æ±‡æ¥é¾™</div>
                        <div class="text-xs text-gray-600 mt-1">é”»ç‚¼è¯æ±‡é‡</div>
                    </div>
                    <div class="mini-game-card" onclick="startMiniGame('math')">
                        <div class="text-3xl mb-2">ğŸ§®</div>
                        <div class="font-semibold text-gray-800">å¿«é€Ÿè®¡ç®—</div>
                        <div class="text-xs text-gray-600 mt-1">æå‡è®¡ç®—åŠ›</div>
                    </div>
                    <div class="mini-game-card" onclick="startMiniGame('memory')">
                        <div class="text-3xl mb-2">ğŸ§ </div>
                        <div class="font-semibold text-gray-800">è®°å¿†è®­ç»ƒ</div>
                        <div class="text-xs text-gray-600 mt-1">å¢å¼ºè®°å¿†</div>
                    </div>
                    <div class="mini-game-card" onclick="startMiniGame('draw')">
                        <div class="text-3xl mb-2">ğŸ¨</div>
                        <div class="font-semibold text-gray-800">ä½ ç”»æˆ‘çŒœ</div>
                        <div class="text-xs text-gray-600 mt-1">å‘æŒ¥åˆ›æ„</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <div class="fixed bottom-6 right-6 flex flex-col space-y-3">
        <button onclick="quickStartActivity()" class="w-14 h-14 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-full shadow-lg flex items-center justify-center text-xl">
            <i class="fas fa-play"></i>
        </button>
        <button onclick="emergencyCall()" class="w-14 h-14 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-full shadow-lg flex items-center justify-center text-xl">
            <i class="fas fa-heart"></i>
        </button>
    </div>

    <!-- æ·»åŠ è®¡åˆ’æ¨¡æ€æ¡† -->
    <div id="addScheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="text-lg font-semibold text-gray-800">åˆ›å»ºæ–°è®¡åˆ’</h4>
                <button onclick="closeAddScheduleModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="form-group">
                        <label class="form-label">æ´»åŠ¨åç§°</label>
                        <input type="text" id="activityName" class="form-input" placeholder="ä¾‹å¦‚ï¼šæ•°å­¦ç»ƒä¹ ã€åˆ›æ„ç»˜ç”»">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">å¼€å§‹æ—¶é—´</label>
                            <input type="time" id="startTime" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <select id="duration" class="form-input">
                                <option value="15">15åˆ†é’Ÿ</option>
                                <option value="30" selected>30åˆ†é’Ÿ</option>
                                <option value="45">45åˆ†é’Ÿ</option>
                                <option value="60">1å°æ—¶</option>
                                <option value="90">1.5å°æ—¶</option>
                            </select>
                        </div>
                    </div>

                    <!-- å‚ä¸è€…é€‰æ‹© -->
                    <div class="form-group">
                        <label class="form-label">å‚ä¸æˆå‘˜</label>
                        <div class="participant-selection">
                            <label class="participant-checkbox">
                                <input type="checkbox" value="parent1" checked> 
                                <span>ğŸ‘¨ çˆ¸çˆ¸</span>
                            </label>
                            <label class="participant-checkbox">
                                <input type="checkbox" value="parent2" checked> 
                                <span>ğŸ‘© å¦ˆå¦ˆ</span>
                            </label>
                            <label class="participant-checkbox">
                                <input type="checkbox" value="child1" checked> 
                                <span>ğŸ‘¦ å°æ˜</span>
                            </label>
                        </div>
                    </div>

                    <!-- è®¡åˆ’ç±»å‹ -->
                    <div class="form-group">
                        <label class="form-label">æ´»åŠ¨ç±»å‹</label>
                        <div class="activity-type-selection">
                            <button type="button" class="activity-type-btn active" data-type="å­¦ä¹ ">
                                <i class="fas fa-book mr-1"></i>å­¦ä¹ 
                            </button>
                            <button type="button" class="activity-type-btn" data-type="æ¸¸æˆ">
                                <i class="fas fa-gamepad mr-1"></i>æ¸¸æˆ
                            </button>
                            <button type="button" class="activity-type-btn" data-type="è¿åŠ¨">
                                <i class="fas fa-running mr-1"></i>è¿åŠ¨
                            </button>
                            <button type="button" class="activity-type-btn" data-type="åˆ›ä½œ">
                                <i class="fas fa-paint-brush mr-1"></i>åˆ›ä½œ
                            </button>
                            <button type="button" class="activity-type-btn" data-type="å…¶ä»–">
                                <i class="fas fa-star mr-1"></i>å…¶ä»–
                            </button>
                        </div>
                    </div>

                    <!-- é‡å¤è®¾ç½® -->
                    <div class="form-group">
                        <label class="form-label">é‡å¤è®¾ç½®</label>
                        <select id="repeatType" class="form-input">
                            <option value="none">ä¸é‡å¤</option>
                            <option value="daily">æ¯å¤©</option>
                            <option value="weekly">æ¯å‘¨</option>
                            <option value="weekdays">å·¥ä½œæ—¥</option>
                            <option value="weekends">å‘¨æœ«</option>
                        </select>
                    </div>

                    <!-- æé†’è®¾ç½® -->
                    <div class="form-group">
                        <label class="form-label">æé†’æ—¶é—´</label>
                        <select id="reminderTime" class="form-input">
                            <option value="0">å¼€å§‹æ—¶æé†’</option>
                            <option value="5" selected>æå‰5åˆ†é’Ÿ</option>
                            <option value="10">æå‰10åˆ†é’Ÿ</option>
                            <option value="15">æå‰15åˆ†é’Ÿ</option>
                            <option value="30">æå‰30åˆ†é’Ÿ</option>
                        </select>
                    </div>

                    <!-- æè¿° -->
                    <div class="form-group">
                        <label class="form-label">æ´»åŠ¨æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="activityDescription" class="form-input" rows="3" placeholder="æè¿°æ´»åŠ¨å†…å®¹ã€ç›®æ ‡æˆ–æ³¨æ„äº‹é¡¹..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeAddScheduleModal()" class="btn-secondary">å–æ¶ˆ</button>
                <button onclick="createSchedulePlan()" class="btn-primary">åˆ›å»ºè®¡åˆ’</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘è®¡åˆ’æ¨¡æ€æ¡† -->
    <div id="editScheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="text-lg font-semibold text-gray-800">ç¼–è¾‘è®¡åˆ’</h4>
                <button onclick="closeEditScheduleModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="editScheduleContent">
                    <!-- åŠ¨æ€ç”Ÿæˆç¼–è¾‘è¡¨å• -->
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="deleteSchedulePlan()" class="btn-danger">åˆ é™¤è®¡åˆ’</button>
                <button onclick="closeEditScheduleModal()" class="btn-secondary">å–æ¶ˆ</button>
                <button onclick="updateSchedulePlan()" class="btn-primary">ä¿å­˜æ›´æ”¹</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å¼¹çª— -->
    <div id="notificationModal" class="notification-modal">
        <div class="notification-panel">
            <div class="notification-header">
                <h3>ğŸ“¢ å®¶åº­é€šçŸ¥</h3>
                <button class="notification-close" onclick="closeNotificationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-body" id="notificationList">
                <!-- åŠ¨æ€ç”Ÿæˆé€šçŸ¥åˆ—è¡¨ -->
            </div>
            <div class="notification-footer">
                <button class="mark-all-read" onclick="markAllNotificationsRead()">
                    å…¨éƒ¨æ ‡è®°å·²è¯»
                </button>
                <button class="view-all" onclick="viewAllNotifications()">
                    æŸ¥çœ‹å…¨éƒ¨
                </button>
            </div>
        </div>
    </div>

    <script>
        let familyData = {
            members: [
                { id: 'parent1', name: 'çˆ¸çˆ¸', avatar: 'ğŸ‘¨', role: 'parent', status: 'online', score: 320, todayActivities: 2 },
                { id: 'parent2', name: 'å¦ˆå¦ˆ', avatar: 'ğŸ‘©', role: 'parent', status: 'online', score: 280, todayActivities: 3 },
                { id: 'child1', name: 'å°æ˜', avatar: 'ğŸ‘¦', role: 'child', status: 'learning', score: 150, todayActivities: 1 }
            ],
            todayStats: {
                activities: 3,
                score: 150,
                interactionTime: 45,
                completionRate: 92
            },
            schedule: [
                { 
                    id: 'plan1',
                    time: '09:00', 
                    duration: 30,
                    activity: 'æ™¨è¯»æ—¶å…‰', 
                    type: 'å­¦ä¹ ',
                    participants: ['parent2', 'child1'], 
                    status: 'completed',
                    description: 'ä¸€èµ·äº«å—ç¾å¥½çš„é˜…è¯»æ—¶å…‰ï¼ŒåŸ¹å…»é˜…è¯»ä¹ æƒ¯',
                    repeatType: 'daily',
                    reminderTime: 5,
                    completedAt: '2024-01-15 09:30'
                },
                { 
                    id: 'plan2',
                    time: '14:00', 
                    duration: 45,
                    activity: 'æ•°å­¦ç»ƒä¹ ', 
                    type: 'å­¦ä¹ ',
                    participants: ['parent1', 'child1'], 
                    status: 'current',
                    description: 'å·©å›ºä»Šæ—¥å­¦ä¹ çš„æ•°å­¦çŸ¥è¯†ç‚¹',
                    repeatType: 'weekdays',
                    reminderTime: 10
                },
                { 
                    id: 'plan3',
                    time: '16:00', 
                    duration: 60,
                    activity: 'åˆ›æ„ç”»ç”»', 
                    type: 'åˆ›ä½œ',
                    participants: ['parent1', 'parent2', 'child1'], 
                    status: 'pending',
                    description: 'å‘æŒ¥æƒ³è±¡åŠ›ï¼Œåˆ›ä½œå±äºè‡ªå·±çš„è‰ºæœ¯ä½œå“',
                    repeatType: 'weekly',
                    reminderTime: 15
                },
                { 
                    id: 'plan4',
                    time: '19:00', 
                    duration: 30,
                    activity: 'æ•…äº‹åˆ†äº«', 
                    type: 'æ¸¸æˆ',
                    participants: ['parent1', 'parent2', 'child1'], 
                    status: 'pending',
                    description: 'åˆ†äº«ä»Šå¤©çš„æœ‰è¶£ç»å†å’Œæ„Ÿå—',
                    repeatType: 'daily',
                    reminderTime: 5
                }
            ],
            weekSchedule: [],
            currentView: 'today',
            selectedPlan: null,
            messages: [
                { sender: 'å¦ˆå¦ˆ', message: 'å°æ˜ä»Šå¤©è¡¨ç°å¾ˆæ£’ï¼', time: '10åˆ†é’Ÿå‰', type: 'text' },
                { sender: 'çˆ¸çˆ¸', message: 'ä¸‹åˆæˆ‘ä»¬ä¸€èµ·åšæ•°å­¦é¢˜å§', time: '30åˆ†é’Ÿå‰', type: 'text' },
                { sender: 'å°æ˜', message: 'æˆ‘æƒ³ç”»ä¸€å¹…å…¨å®¶ç¦', time: '1å°æ—¶å‰', type: 'voice' }
            ],
            notifications: [
                {
                    id: 'notif1',
                    type: 'success',
                    title: 'å­¦ä¹ ä»»åŠ¡å®Œæˆ',
                    message: 'å°æ˜å®Œæˆäº†ä»Šæ—¥æ•°å­¦ç»ƒä¹ ï¼Œè¡¨ç°ä¼˜ç§€ï¼è·å¾—20ç§¯åˆ†å¥–åŠ±ã€‚',
                    time: '5åˆ†é’Ÿå‰',
                    isRead: false,
                    actions: [
                        { text: 'æŸ¥çœ‹è¯¦æƒ…', action: 'viewTaskDetail', primary: true },
                        { text: 'ç‚¹èµ', action: 'likeTask' }
                    ]
                },
                {
                    id: 'notif2',
                    type: 'info',
                    title: 'æ–°æŒ‘æˆ˜å¼€å¯',
                    message: 'æœ¬å‘¨å®¶åº­æŒ‘æˆ˜"åˆ›æ„ç»˜ç”»å‘¨"ç°å·²å¼€å¯ï¼Œé‚€è¯·å…¨å®¶äººä¸€èµ·å‚ä¸ï¼',
                    time: '15åˆ†é’Ÿå‰',
                    isRead: false,
                    actions: [
                        { text: 'ç«‹å³å‚ä¸', action: 'joinChallenge', primary: true }
                    ]
                },
                {
                    id: 'notif3',
                    type: 'info',
                    title: 'å­¦ä¹ å¿ƒå¾—åˆ†äº«',
                    message: 'çˆ¸çˆ¸åˆ†äº«äº†å…³äº"å¦‚ä½•åŸ¹å…»å­©å­é˜…è¯»ä¹ æƒ¯"çš„å¿ƒå¾—ä½“ä¼šã€‚',
                    time: '30åˆ†é’Ÿå‰',
                    isRead: true,
                    actions: [
                        { text: 'é˜…è¯»å…¨æ–‡', action: 'readArticle' }
                    ]
                },
                {
                    id: 'notif4',
                    type: 'warning',
                    title: 'è®¡åˆ’æé†’',
                    message: 'è·ç¦»"åˆ›æ„ç”»ç”»"æ´»åŠ¨å¼€å§‹è¿˜æœ‰5åˆ†é’Ÿï¼Œè¯·åšå¥½å‡†å¤‡ï¼',
                    time: '1å°æ—¶å‰',
                    isRead: true
                }
            ]
        };

        // é¡µé¢åˆå§‹åŒ–
        MengyaUtils.Lifecycle.onInit(() => {
            updateFamilyGreeting();
            updateWeatherInfo();
            updateFamilyStats();
            loadFamilyMembers();
            loadSchedule();
            loadFamilyMessages();
            updateNotificationBadge();
            startRealTimeUpdates();
        });

        // æ›´æ–°å®¶åº­é—®å€™è¯­
        function updateFamilyGreeting() {
            const hour = new Date().getHours();
            let greeting, motivation;
            
            if (hour < 12) {
                greeting = "æ—©å®‰ï¼ç¾å¥½çš„ä¸€å¤©ä»å­¦ä¹ å¼€å§‹";
                motivation = "ä»Šå¤©è¦ä¸€èµ·å®Œæˆä»€ä¹ˆæœ‰è¶£çš„æ´»åŠ¨å‘¢ï¼Ÿ";
            } else if (hour < 18) {
                greeting = "ä¸‹åˆå¥½ï¼ç»§ç»­æˆ‘ä»¬çš„å­¦ä¹ ä¹‹æ—…";
                motivation = "åˆåæ—¶å…‰æœ€é€‚åˆäº²å­äº’åŠ¨äº†";
            } else {
                greeting = "æ™šä¸Šå¥½ï¼æ¸©é¦¨çš„å®¶åº­æ—¶å…‰";
                motivation = "ä»Šå¤©çš„å­¦ä¹ æˆæœè®©æˆ‘ä»¬ä¸€èµ·å›é¡¾å§";
            }
            
            document.getElementById('familyGreeting').textContent = greeting;
            document.getElementById('familyMotivation').textContent = motivation;
        }

        // æ›´æ–°å¤©æ°”ä¿¡æ¯
        function updateWeatherInfo() {
            // æ¨¡æ‹Ÿå¤©æ°”æ•°æ®
            const weathers = ['â˜€ï¸ æ™´å¤© 22Â°C', 'â›… å¤šäº‘ 20Â°C', 'ğŸŒ§ï¸ å°é›¨ 18Â°C', 'â„ï¸ é›ªå¤© 5Â°C'];
            const moods = ['å¿«ä¹æ„‰æ‚¦', 'è½»æ¾æƒ¬æ„', 'æ¸©é¦¨èˆ’é€‚', 'å……æ»¡æœŸå¾…'];
            
            document.getElementById('weatherInfo').textContent = weathers[Math.floor(Math.random() * weathers.length)];
            document.getElementById('familyMoodText').textContent = moods[Math.floor(Math.random() * moods.length)];
        }

        // æ›´æ–°å®¶åº­ç»Ÿè®¡
        function updateFamilyStats() {
            const stats = familyData.todayStats;
            document.getElementById('todayActivities').textContent = stats.activities;
            document.getElementById('familyScore').textContent = stats.score;
            document.getElementById('interactionTime').textContent = stats.interactionTime + 'min';
            document.getElementById('completionRate').textContent = stats.completionRate + '%';
        }

        // åŠ è½½å®¶åº­æˆå‘˜
        function loadFamilyMembers() {
            const container = document.getElementById('familyMembers');
            container.innerHTML = familyData.members.map(member => {
                const statusColors = {
                    online: 'bg-green-100 text-green-600',
                    learning: 'bg-blue-100 text-blue-600',
                    busy: 'bg-yellow-100 text-yellow-600',
                    offline: 'bg-gray-100 text-gray-600'
                };
                
                const statusTexts = {
                    online: 'åœ¨çº¿',
                    learning: 'å­¦ä¹ ä¸­',
                    busy: 'å¿™ç¢Œ',
                    offline: 'ç¦»çº¿'
                };

                return `
                    <div class="interaction-bubble">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 text-2xl flex items-center justify-center">
                                ${member.avatar}
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <h4 class="font-semibold text-gray-800">${member.name}</h4>
                                    <span class="text-xs px-2 py-1 rounded-full ${statusColors[member.status]}">
                                        ${statusTexts[member.status]}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600">${member.role === 'parent' ? 'å®¶é•¿' : 'å­©å­'}</p>
                                <div class="flex items-center space-x-4 mt-2">
                                    <span class="text-xs text-gray-500">
                                        <i class="fas fa-trophy mr-1"></i>
                                        ç§¯åˆ†: ${member.score}
                                    </span>
                                    <span class="text-xs text-gray-500">
                                        <i class="fas fa-calendar mr-1"></i>
                                        ä»Šæ—¥æ´»åŠ¨: ${member.todayActivities}
                                    </span>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button onclick="inviteMember('${member.id}')" class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors">
                                    <i class="fas fa-plus text-xs"></i>
                                </button>
                                <button onclick="chatWithMember('${member.id}')" class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 transition-colors">
                                    <i class="fas fa-comment text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åŠ è½½å­¦ä¹ è®¡åˆ’ - å¢å¼ºç‰ˆ
        function loadSchedule() {
            const container = document.getElementById('scheduleList');
            const currentSchedule = familyData.currentView === 'today' ? familyData.schedule : familyData.weekSchedule;
            
            container.innerHTML = currentSchedule.map(item => {
                const statusIcons = {
                    completed: 'âœ…',
                    current: 'ğŸ”„',
                    pending: 'â°'
                };
                
                const typeIcons = {
                    'å­¦ä¹ ': 'ğŸ“š',
                    'æ¸¸æˆ': 'ğŸ®',
                    'è¿åŠ¨': 'ğŸƒ',
                    'åˆ›ä½œ': 'ğŸ¨',
                    'å…¶ä»–': 'â­'
                };
                
                const participantNames = item.participants.map(pid => {
                    const member = familyData.members.find(m => m.id === pid);
                    return member ? member.name : pid;
                });
                
                const endTime = calculateEndTime(item.time, item.duration);
                
                return `
                    <div class="schedule-item-enhanced ${item.status}" data-plan-id="${item.id}">
                        <div class="plan-header">
                            <div class="plan-title">
                                ${typeIcons[item.type]} ${item.activity}
                            </div>
                            <div class="plan-time">${item.time} - ${endTime}</div>
                        </div>
                        
                        <div class="plan-participants">
                            ${participantNames.map(name => `<span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">${name}</span>`).join('')}
                        </div>
                        
                        ${item.description ? `<div class="text-sm text-gray-600 mb-2">${item.description}</div>` : ''}
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span>${statusIcons[item.status]} ${getStatusText(item.status)}</span>
                                ${item.repeatType !== 'none' ? `<span>â€¢ ğŸ”„ ${getRepeatText(item.repeatType)}</span>` : ''}
                                ${item.reminderTime > 0 ? `<span>â€¢ ğŸ”” æå‰${item.reminderTime}åˆ†é’Ÿ</span>` : ''}
                            </div>
                        </div>
                        
                        <div class="plan-actions">
                            ${item.status === 'pending' ? `<button onclick="startPlan('${item.id}')" class="action-btn primary">å¼€å§‹æ‰§è¡Œ</button>` : ''}
                            ${item.status === 'current' ? `<button onclick="completePlan('${item.id}')" class="action-btn primary">å®Œæˆ</button>` : ''}
                            <button onclick="editPlan('${item.id}')" class="action-btn">ç¼–è¾‘</button>
                            <button onclick="duplicatePlan('${item.id}')" class="action-btn">å¤åˆ¶</button>
                            ${item.status === 'completed' ? `<button onclick="restartPlan('${item.id}')" class="action-btn">é‡æ–°å¼€å§‹</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateScheduleStats();
        }

        // åŠ è½½å®¶åº­ç•™è¨€
        function loadFamilyMessages() {
            const container = document.getElementById('familyMessages');
            container.innerHTML = familyData.messages.map(msg => {
                if (msg.type === 'voice') {
                    return `
                        <div class="voice-message">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-microphone"></i>
                                <div class="flex-1">
                                    <div class="font-semibold">${msg.sender}</div>
                                    <div class="text-sm opacity-90">${msg.message}</div>
                                </div>
                                <div class="text-xs opacity-75">${msg.time}</div>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="interaction-bubble">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white text-sm">
                                    ${msg.sender[0]}
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">${msg.sender}</div>
                                    <div class="text-sm text-gray-600">${msg.message}</div>
                                </div>
                                <div class="text-xs text-gray-500">${msg.time}</div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            event.target.classList.add('active');
        }

        // å¯åŠ¨æ¨èæ´»åŠ¨
        function startRecommendedActivity(type) {
            MengyaUtils.Notification.success('æ­£åœ¨å¯åŠ¨æ¨èæ´»åŠ¨...');
            setTimeout(() => {
                if (type === 'story') {
                    parent.postMessage({ type: 'openPage', url: 'collaborative-learning.html?activity=story' }, '*');
                }
            }, 1000);
        }

        // è·å–æ›´å¤šæ¨è
        function getMoreRecommendations() {
            const recommendations = [
                'æ•°å­¦æ¸¸æˆï¼šæå‡é€»è¾‘æ€ç»´èƒ½åŠ›',
                'ç»˜ç”»åˆ›ä½œï¼šåŸ¹å…»è‰ºæœ¯æ„ŸçŸ¥åŠ›',
                'éŸ³ä¹å¾‹åŠ¨ï¼šå¢å¼ºèŠ‚å¥æ„Ÿ',
                'ç§‘å­¦å®éªŒï¼šæ¿€å‘æ¢ç´¢ç²¾ç¥'
            ];
            
            const randomRec = recommendations[Math.floor(Math.random() * recommendations.length)];
            MengyaUtils.Notification.info(`æ–°æ¨èï¼š${randomRec}`);
        }

        // é‚€è¯·æˆå‘˜å‚ä¸æ´»åŠ¨
        function inviteMember(memberId) {
            const member = familyData.members.find(m => m.id === memberId);
            if (member) {
                MengyaUtils.Notification.success(`å·²é‚€è¯·${member.name}å‚ä¸æ´»åŠ¨ï¼`);
            }
        }

        // ä¸æˆå‘˜èŠå¤©
        function chatWithMember(memberId) {
            const member = familyData.members.find(m => m.id === memberId);
            if (member) {
                MengyaUtils.Notification.info(`æ­£åœ¨æ‰“å¼€ä¸${member.name}çš„èŠå¤©...`);
            }
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                familyData.messages.unshift({
                    sender: 'æˆ‘',
                    message: message,
                    time: 'åˆšåˆš',
                    type: 'text'
                });
                
                input.value = '';
                loadFamilyMessages();
                MengyaUtils.Notification.success('æ¶ˆæ¯å·²å‘é€ï¼');
            }
        }

        // å‘é€è¯­éŸ³æ¶ˆæ¯
        function sendVoiceMessage() {
            MengyaUtils.Notification.info('è¯­éŸ³æ¶ˆæ¯åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // è¾…åŠ©å‡½æ•°
        function calculateEndTime(startTime, duration) {
            const [hours, minutes] = startTime.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes + duration;
            const endHours = Math.floor(totalMinutes / 60);
            const endMinutes = totalMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${endMinutes.toString().padStart(2, '0')}`;
        }
        
        function getStatusText(status) {
            const texts = {
                completed: 'å·²å®Œæˆ',
                current: 'è¿›è¡Œä¸­',
                pending: 'å¾…æ‰§è¡Œ'
            };
            return texts[status];
        }
        
        function getRepeatText(repeatType) {
            const texts = {
                daily: 'æ¯æ—¥',
                weekly: 'æ¯å‘¨',
                weekdays: 'å·¥ä½œæ—¥',
                weekends: 'å‘¨æœ«',
                none: 'ä¸é‡å¤'
            };
            return texts[repeatType];
        }
        
        // æ›´æ–°è®¡åˆ’ç»Ÿè®¡
        function updateScheduleStats() {
            const schedule = familyData.currentView === 'today' ? familyData.schedule : familyData.weekSchedule;
            const stats = {
                total: schedule.length,
                completed: schedule.filter(p => p.status === 'completed').length,
                pending: schedule.filter(p => p.status === 'pending').length
            };
            
            document.getElementById('todayPlansCount').textContent = stats.total;
            document.getElementById('completedPlansCount').textContent = stats.completed;
            document.getElementById('pendingPlansCount').textContent = stats.pending;
        }

        // åˆ‡æ¢è®¡åˆ’è§†å›¾
        function switchScheduleView(view) {
            familyData.currentView = view;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.schedule-view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(view + 'ViewBtn').classList.add('active');
            
            // å¦‚æœæ˜¯å‘¨è§†å›¾ä¸”æ²¡æœ‰æ•°æ®ï¼Œç”Ÿæˆå‘¨è®¡åˆ’
            if (view === 'week' && familyData.weekSchedule.length === 0) {
                generateWeekSchedule();
            }
            
            loadSchedule();
        }

        // ç”Ÿæˆå‘¨è®¡åˆ’
        function generateWeekSchedule() {
            familyData.weekSchedule = [];
            const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            
            days.forEach((day, index) => {
                familyData.weekSchedule.push({
                    id: `week_plan_${index}`,
                    time: '09:00',
                    duration: 30,
                    activity: `${day}æ™¨è¯»`,
                    type: 'å­¦ä¹ ',
                    participants: ['parent2', 'child1'],
                    status: index < 2 ? 'completed' : 'pending',
                    description: `${day}çš„é˜…è¯»æ—¶å…‰`,
                    repeatType: 'daily',
                    reminderTime: 5
                });
            });
        }

        // å¿«é€Ÿæ·»åŠ è®¡åˆ’
        function addQuickPlan(type) {
            const templates = {
                'å­¦ä¹ ': {
                    activity: 'å­¦ä¹ æ—¶å…‰',
                    duration: 45,
                    description: 'ä¸“æ³¨å­¦ä¹ ï¼Œæå‡èƒ½åŠ›'
                },
                'æ¸¸æˆ': {
                    activity: 'äº²å­æ¸¸æˆ',
                    duration: 30,
                    description: 'äº«å—å¿«ä¹çš„æ¸¸æˆæ—¶å…‰'
                },
                'è¿åŠ¨': {
                    activity: 'æˆ·å¤–è¿åŠ¨',
                    duration: 60,
                    description: 'å¼ºèº«å¥ä½“ï¼Œå¢è¿›æ„Ÿæƒ…'
                },
                'åˆ›ä½œ': {
                    activity: 'åˆ›æ„åˆ›ä½œ',
                    duration: 45,
                    description: 'å‘æŒ¥åˆ›æ„ï¼Œå±•ç°æ‰å'
                }
            };
            
            const template = templates[type];
            const now = new Date();
            const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
            const timeStr = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            
            const newPlan = {
                id: `quick_plan_${Date.now()}`,
                time: timeStr,
                duration: template.duration,
                activity: template.activity,
                type: type,
                participants: ['parent1', 'parent2', 'child1'],
                status: 'pending',
                description: template.description,
                repeatType: 'none',
                reminderTime: 5
            };
            
            familyData.schedule.push(newPlan);
            loadSchedule();
            MengyaUtils.Notification.success(`${type}è®¡åˆ’å·²æ·»åŠ ï¼`);
        }

        // æ˜¾ç¤ºæ·»åŠ è®¡åˆ’æ¨¡æ€æ¡†
        function showAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.add('show');
            
            // è®¾ç½®é»˜è®¤æ—¶é—´ä¸ºä¸‹ä¸€ä¸ªæ•´ç‚¹
            const now = new Date();
            const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
            const timeStr = `${nextHour.getHours().toString().padStart(2, '0')}:00`;
            document.getElementById('startTime').value = timeStr;
        }

        // å…³é—­æ·»åŠ è®¡åˆ’æ¨¡æ€æ¡†
        function closeAddScheduleModal() {
            document.getElementById('addScheduleModal').classList.remove('show');
            document.getElementById('scheduleForm').reset();
        }

        // åˆ›å»ºè®¡åˆ’
        function createSchedulePlan() {
            const formData = {
                activity: document.getElementById('activityName').value,
                time: document.getElementById('startTime').value,
                duration: parseInt(document.getElementById('duration').value),
                description: document.getElementById('activityDescription').value,
                repeatType: document.getElementById('repeatType').value,
                reminderTime: parseInt(document.getElementById('reminderTime').value)
            };
            
            // è·å–é€‰ä¸­çš„å‚ä¸è€…
            const participants = Array.from(document.querySelectorAll('.participant-checkbox input:checked'))
                .map(input => input.value);
            
            // è·å–é€‰ä¸­çš„æ´»åŠ¨ç±»å‹
            const activeTypeBtn = document.querySelector('.activity-type-btn.active');
            const activityType = activeTypeBtn ? activeTypeBtn.dataset.type : 'å…¶ä»–';
            
            if (!formData.activity || !formData.time || participants.length === 0) {
                MengyaUtils.Notification.error('è¯·å¡«å†™å®Œæ•´çš„è®¡åˆ’ä¿¡æ¯ï¼');
                return;
            }
            
            const newPlan = {
                id: `plan_${Date.now()}`,
                time: formData.time,
                duration: formData.duration,
                activity: formData.activity,
                type: activityType,
                participants: participants,
                status: 'pending',
                description: formData.description,
                repeatType: formData.repeatType,
                reminderTime: formData.reminderTime
            };
            
            familyData.schedule.push(newPlan);
            familyData.schedule.sort((a, b) => a.time.localeCompare(b.time));
            
            loadSchedule();
            closeAddScheduleModal();
            MengyaUtils.Notification.success('æ–°è®¡åˆ’åˆ›å»ºæˆåŠŸï¼');
        }

        // è®¡åˆ’æ“ä½œå‡½æ•°
        function startPlan(planId) {
            const plan = familyData.schedule.find(p => p.id === planId);
            if (plan) {
                plan.status = 'current';
                plan.startedAt = new Date().toISOString();
                loadSchedule();
                MengyaUtils.Notification.success(`å¼€å§‹æ‰§è¡Œï¼š${plan.activity}`);
            }
        }

        function completePlan(planId) {
            const plan = familyData.schedule.find(p => p.id === planId);
            if (plan) {
                plan.status = 'completed';
                plan.completedAt = new Date().toISOString();
                loadSchedule();
                MengyaUtils.Notification.success(`å®Œæˆäº†ï¼š${plan.activity}ï¼`);
                
                // å¢åŠ å®¶åº­ç§¯åˆ†
                familyData.todayStats.score += 20;
                updateFamilyStats();
                
                // æ·»åŠ å®Œæˆé€šçŸ¥
                addNotification(
                    'success',
                    'è®¡åˆ’å®Œæˆ',
                    `å¤ªæ£’äº†ï¼"${plan.activity}"å·²é¡ºåˆ©å®Œæˆï¼Œè·å¾—äº†20ç§¯åˆ†å¥–åŠ±ï¼`,
                    [
                        { text: 'æŸ¥çœ‹è¯¦æƒ…', action: 'viewTaskDetail', primary: true },
                        { text: 'åˆ†äº«æˆæœ', action: 'shareResult' }
                    ]
                );
            }
        }

        function editPlan(planId) {
            familyData.selectedPlan = familyData.schedule.find(p => p.id === planId);
            if (familyData.selectedPlan) {
                showEditScheduleModal();
            }
        }

        function duplicatePlan(planId) {
            const originalPlan = familyData.schedule.find(p => p.id === planId);
            if (originalPlan) {
                const newPlan = {
                    ...originalPlan,
                    id: `plan_${Date.now()}`,
                    status: 'pending'
                };
                delete newPlan.startedAt;
                delete newPlan.completedAt;
                
                familyData.schedule.push(newPlan);
                loadSchedule();
                MengyaUtils.Notification.success('è®¡åˆ’å·²å¤åˆ¶ï¼');
            }
        }

        function restartPlan(planId) {
            const plan = familyData.schedule.find(p => p.id === planId);
            if (plan) {
                plan.status = 'pending';
                delete plan.startedAt;
                delete plan.completedAt;
                loadSchedule();
                MengyaUtils.Notification.success('è®¡åˆ’å·²é‡æ–°å¼€å§‹ï¼');
            }
        }

        function showEditScheduleModal() {
            // å®ç°ç¼–è¾‘æ¨¡æ€æ¡†æ˜¾ç¤ºé€»è¾‘
            document.getElementById('editScheduleModal').classList.add('show');
            MengyaUtils.Notification.info('ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function closeEditScheduleModal() {
            document.getElementById('editScheduleModal').classList.remove('show');
            familyData.selectedPlan = null;
        }

        function updateSchedulePlan() {
            MengyaUtils.Notification.info('æ›´æ–°åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function deleteSchedulePlan() {
            if (familyData.selectedPlan) {
                const index = familyData.schedule.findIndex(p => p.id === familyData.selectedPlan.id);
                if (index > -1) {
                    familyData.schedule.splice(index, 1);
                    loadSchedule();
                    closeEditScheduleModal();
                    MengyaUtils.Notification.success('è®¡åˆ’å·²åˆ é™¤ï¼');
                }
            }
        }

        // å¯åŠ¨å°æ¸¸æˆ
        function startMiniGame(gameType) {
            const gameNames = {
                word: 'è¯æ±‡æ¥é¾™',
                math: 'å¿«é€Ÿè®¡ç®—',
                memory: 'è®°å¿†è®­ç»ƒ',
                draw: 'ä½ ç”»æˆ‘çŒœ'
            };
            
            MengyaUtils.Notification.success(`æ­£åœ¨å¯åŠ¨${gameNames[gameType]}...`);
            
            setTimeout(() => {
                parent.postMessage({ 
                    type: 'openPage', 
                    url: `collaborative-learning.html?activity=${gameType}` 
                }, '*');
            }, 1000);
        }

        // æ˜¾ç¤ºé€šçŸ¥å¼¹çª—
        function showNotifications() {
            loadNotifications();
            document.getElementById('notificationModal').classList.add('show');
        }

        // å…³é—­é€šçŸ¥å¼¹çª—
        function closeNotificationModal() {
            document.getElementById('notificationModal').classList.remove('show');
        }

        // åŠ è½½é€šçŸ¥åˆ—è¡¨
        function loadNotifications() {
            const container = document.getElementById('notificationList');
            
            if (familyData.notifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-bell-slash text-3xl mb-3"></i>
                        <div>æš‚æ— æ–°é€šçŸ¥</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = familyData.notifications.map(notification => {
                const iconMap = {
                    success: 'fa-check-circle',
                    info: 'fa-info-circle',
                    warning: 'fa-exclamation-triangle'
                };
                
                return `
                    <div class="notification-item ${!notification.isRead ? 'unread' : ''}" data-id="${notification.id}">
                        <div class="notification-icon ${notification.type}">
                            <i class="fas ${iconMap[notification.type]}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${notification.time}</div>
                            ${notification.actions ? `
                                <div class="notification-actions">
                                    ${notification.actions.map(action => `
                                        <button class="notification-btn ${action.primary ? 'primary' : ''}" 
                                                onclick="handleNotificationAction('${notification.id}', '${action.action}')">
                                            ${action.text}
                                        </button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateNotificationBadge();
        }

        // æ›´æ–°é€šçŸ¥çº¢ç‚¹
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const unreadCount = familyData.notifications.filter(n => !n.isRead).length;
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // å¤„ç†é€šçŸ¥æ“ä½œ
        function handleNotificationAction(notificationId, action) {
            const notification = familyData.notifications.find(n => n.id === notificationId);
            if (!notification) return;
            
            // æ ‡è®°ä¸ºå·²è¯»
            notification.isRead = true;
            
            switch (action) {
                case 'viewTaskDetail':
                    MengyaUtils.Notification.info('æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…...');
                    closeNotificationModal();
                    break;
                case 'likeTask':
                    MengyaUtils.Notification.success('å·²ç‚¹èµï¼');
                    break;
                case 'joinChallenge':
                    MengyaUtils.Notification.success('å·²åŠ å…¥æŒ‘æˆ˜ï¼');
                    closeNotificationModal();
                    break;
                case 'readArticle':
                    MengyaUtils.Notification.info('æ‰“å¼€æ–‡ç« ...');
                    closeNotificationModal();
                    break;
                default:
                    break;
            }
            
            loadNotifications();
        }

        // æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»
        function markAllNotificationsRead() {
            familyData.notifications.forEach(notification => {
                notification.isRead = true;
            });
            loadNotifications();
            MengyaUtils.Notification.success('æ‰€æœ‰é€šçŸ¥å·²æ ‡è®°ä¸ºå·²è¯»');
        }

        // æŸ¥çœ‹å…¨éƒ¨é€šçŸ¥
        function viewAllNotifications() {
            closeNotificationModal();
            MengyaUtils.Notification.info('è·³è½¬åˆ°é€šçŸ¥ä¸­å¿ƒ...');
        }

        // æ·»åŠ æ–°é€šçŸ¥
        function addNotification(type, title, message, actions = null) {
            const newNotification = {
                id: `notif_${Date.now()}`,
                type: type,
                title: title,
                message: message,
                time: 'åˆšåˆš',
                isRead: false,
                actions: actions
            };
            
            familyData.notifications.unshift(newNotification);
            updateNotificationBadge();
            
            // å¦‚æœé€šçŸ¥å¼¹çª—æ˜¯æ‰“å¼€çš„ï¼Œåˆ™åˆ·æ–°åˆ—è¡¨
            if (document.getElementById('notificationModal').classList.contains('show')) {
                loadNotifications();
            }
        }

        // å¿«é€Ÿå¯åŠ¨æ´»åŠ¨
        function quickStartActivity() {
            const activities = ['story', 'math', 'art', 'music'];
            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            
            MengyaUtils.Notification.success('æ­£åœ¨ä¸ºæ‚¨åŒ¹é…æœ€é€‚åˆçš„æ´»åŠ¨...');
            
            setTimeout(() => {
                startRecommendedActivity(randomActivity);
            }, 1500);
        }

        // ç´§æ€¥å‘¼å«ï¼ˆå®¶åº­å…³çˆ±åŠŸèƒ½ï¼‰
        function emergencyCall() {
            if (confirm('ç¡®å®šè¦å‘é€å®¶åº­å…³çˆ±ä¿¡å·å—ï¼Ÿ\nè¿™ä¼šé€šçŸ¥æ‰€æœ‰å®¶åº­æˆå‘˜ç«‹å³å…³æ³¨ã€‚')) {
                MengyaUtils.Notification.success('â¤ï¸ å®¶åº­å…³çˆ±ä¿¡å·å·²å‘é€');
            }
        }

        // å®æ—¶æ›´æ–°
        function startRealTimeUpdates() {
            setInterval(() => {
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                familyData.todayStats.activities += Math.random() > 0.8 ? 1 : 0;
                familyData.todayStats.score += Math.random() > 0.7 ? Math.floor(Math.random() * 10) : 0;
                familyData.todayStats.interactionTime += Math.random() > 0.6 ? 1 : 0;
                
                updateFamilyStats();
                
                // æ¨¡æ‹Ÿæˆå‘˜çŠ¶æ€å˜åŒ–
                familyData.members.forEach(member => {
                    if (Math.random() > 0.9) {
                        const statuses = ['online', 'learning', 'busy'];
                        member.status = statuses[Math.floor(Math.random() * statuses.length)];
                    }
                });
                
                loadFamilyMembers();
            }, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function navigateBack() {
            MengyaUtils.Navigation.smartBack();
        }

        // ç›‘å¬é”®ç›˜äº‹ä»¶
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // æ´»åŠ¨ç±»å‹æŒ‰é’®åˆ‡æ¢
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('activity-type-btn')) {
                    document.querySelectorAll('.activity-type-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.target.classList.add('active');
                }
            });

            // æ¨¡æ€æ¡†å¤–éƒ¨ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
                // é€šçŸ¥å¼¹çª—å¤–éƒ¨ç‚¹å‡»å…³é—­
                if (e.target.classList.contains('notification-modal')) {
                    e.target.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html> 